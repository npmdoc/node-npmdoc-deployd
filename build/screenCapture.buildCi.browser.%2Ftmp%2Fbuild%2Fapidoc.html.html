<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/deployd/deployd#readme">deployd (v0.8.9)</a>
</h1>
<h4>the simplest way to build realtime APIs for web and mobile apps</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd">module deployd</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.deployd">
            function <span class="apidocSignatureSpan"></span>deployd
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.attach">
            function <span class="apidocSignatureSpan">deployd.</span>attach
            <span class="apidocSignatureSpan">(httpServer, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.client_js">
            function <span class="apidocSignatureSpan">deployd.</span>client_js
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.context">
            function <span class="apidocSignatureSpan">deployd.</span>context
            <span class="apidocSignatureSpan">(resource, req, res, server)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.dashboard">
            function <span class="apidocSignatureSpan">deployd.</span>dashboard
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.files">
            function <span class="apidocSignatureSpan">deployd.</span>files
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.internal_resources">
            function <span class="apidocSignatureSpan">deployd.</span>internal_resources
            <span class="apidocSignatureSpan">(settings, server)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.keys">
            function <span class="apidocSignatureSpan">deployd.</span>keys
            <span class="apidocSignatureSpan">(path)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.resource">
            function <span class="apidocSignatureSpan">deployd.</span>resource
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.router">
            function <span class="apidocSignatureSpan">deployd.</span>router
            <span class="apidocSignatureSpan">(resources, server)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.script">
            function <span class="apidocSignatureSpan">deployd.</span>script
            <span class="apidocSignatureSpan">(src, path)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.server">
            function <span class="apidocSignatureSpan">deployd.</span>server
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.user_collection">
            function <span class="apidocSignatureSpan">deployd.</span>user_collection
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>ayepromise</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>client_js.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>config_loader</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>context.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>dashboard.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>db</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>files.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>http</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>internal_client</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>internal_resources.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>keys.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>mongod</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>resource.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>router.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>script.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>server.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>session</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>user_collection.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.</span>uuid</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.ayepromise">module deployd.ayepromise</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.ayepromise.defer">
            function <span class="apidocSignatureSpan">deployd.ayepromise.</span>defer
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.client_js">module deployd.client_js</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.client_js.client_js">
            function <span class="apidocSignatureSpan">deployd.</span>client_js
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.client_js.super_">
            function <span class="apidocSignatureSpan">deployd.client_js.</span>super_
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.client_js.prototype">module deployd.client_js.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.client_js.prototype.generate">
            function <span class="apidocSignatureSpan">deployd.client_js.prototype.</span>generate
            <span class="apidocSignatureSpan">(res, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.client_js.prototype.generateResource">
            function <span class="apidocSignatureSpan">deployd.client_js.prototype.</span>generateResource
            <span class="apidocSignatureSpan">(r, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.client_js.prototype.handle">
            function <span class="apidocSignatureSpan">deployd.client_js.prototype.</span>handle
            <span class="apidocSignatureSpan">(ctx, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.client_js.prototype.load">
            function <span class="apidocSignatureSpan">deployd.client_js.prototype.</span>load
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.config_loader">module deployd.config_loader</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.config_loader.loadConfig">
            function <span class="apidocSignatureSpan">deployd.config_loader.</span>loadConfig
            <span class="apidocSignatureSpan">(basepath, server, fn)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.context">module deployd.context</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.context.context">
            function <span class="apidocSignatureSpan">deployd.</span>context
            <span class="apidocSignatureSpan">(resource, req, res, server)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.context.prototype">module deployd.context.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.context.prototype.done">
            function <span class="apidocSignatureSpan">deployd.context.prototype.</span>done
            <span class="apidocSignatureSpan">(err, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.context.prototype.end">
            function <span class="apidocSignatureSpan">deployd.context.prototype.</span>end
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.dashboard">module deployd.dashboard</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.dashboard.dashboard">
            function <span class="apidocSignatureSpan">deployd.</span>dashboard
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.dashboard.super_">
            function <span class="apidocSignatureSpan">deployd.dashboard.</span>super_
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.dashboard.prototype">module deployd.dashboard.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.dashboard.prototype.handle">
            function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>handle
            <span class="apidocSignatureSpan">(ctx, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.dashboard.prototype.loadAdvancedDashboard">
            function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>loadAdvancedDashboard
            <span class="apidocSignatureSpan">(data, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.dashboard.prototype.loadBasicDashboard">
            function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>loadBasicDashboard
            <span class="apidocSignatureSpan">(data, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.dashboard.prototype.loadLayout">
            function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>loadLayout
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.dashboard.prototype.loadPage">
            function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>loadPage
            <span class="apidocSignatureSpan">(ctx, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.dashboard.prototype.loadTypes">
            function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>loadTypes
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.dashboard.prototype.render">
            function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>render
            <span class="apidocSignatureSpan">(ctx)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.dashboard.prototype.serveCustomAsset">
            function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>serveCustomAsset
            <span class="apidocSignatureSpan">(ctx, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.db">module deployd.db</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.db.Db">
            function <span class="apidocSignatureSpan">deployd.db.</span>Db
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.db.Store">
            function <span class="apidocSignatureSpan">deployd.db.</span>Store
            <span class="apidocSignatureSpan">(namespace, db)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.db.create">
            function <span class="apidocSignatureSpan">deployd.db.</span>create
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.files">module deployd.files</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.files.files">
            function <span class="apidocSignatureSpan">deployd.</span>files
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.files.super_">
            function <span class="apidocSignatureSpan">deployd.files.</span>super_
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.files.prototype">module deployd.files.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.files.prototype.handle">
            function <span class="apidocSignatureSpan">deployd.files.prototype.</span>handle
            <span class="apidocSignatureSpan">(ctx, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.http">module deployd.http</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.http.getBody">
            function <span class="apidocSignatureSpan">deployd.http.</span>getBody
            <span class="apidocSignatureSpan">(req, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.http.parseBody">
            function <span class="apidocSignatureSpan">deployd.http.</span>parseBody
            <span class="apidocSignatureSpan">(req, res, mime, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.http.parseQuery">
            function <span class="apidocSignatureSpan">deployd.http.</span>parseQuery
            <span class="apidocSignatureSpan">(url)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.http.redirect">
            function <span class="apidocSignatureSpan">deployd.http.</span>redirect
            <span class="apidocSignatureSpan">(res, url, statusCode)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.http.setup">
            function <span class="apidocSignatureSpan">deployd.http.</span>setup
            <span class="apidocSignatureSpan">(options, req, res, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.internal_client">module deployd.internal_client</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.internal_client.build">
            function <span class="apidocSignatureSpan">deployd.internal_client.</span>build
            <span class="apidocSignatureSpan">(server, session, stack, ctx)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.internal_resources">module deployd.internal_resources</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.internal_resources.internal_resources">
            function <span class="apidocSignatureSpan">deployd.</span>internal_resources
            <span class="apidocSignatureSpan">(settings, server)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.internal_resources.super_">
            function <span class="apidocSignatureSpan">deployd.internal_resources.</span>super_
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.internal_resources.prototype">module deployd.internal_resources.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.internal_resources.prototype.handle">
            function <span class="apidocSignatureSpan">deployd.internal_resources.prototype.</span>handle
            <span class="apidocSignatureSpan">(ctx, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.keys">module deployd.keys</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.keys.keys">
            function <span class="apidocSignatureSpan">deployd.</span>keys
            <span class="apidocSignatureSpan">(path)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.keys.prototype">module deployd.keys.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.keys.prototype.create">
            function <span class="apidocSignatureSpan">deployd.keys.prototype.</span>create
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.keys.prototype.generate">
            function <span class="apidocSignatureSpan">deployd.keys.prototype.</span>generate
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.keys.prototype.get">
            function <span class="apidocSignatureSpan">deployd.keys.prototype.</span>get
            <span class="apidocSignatureSpan">(key, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.keys.prototype.getLocal">
            function <span class="apidocSignatureSpan">deployd.keys.prototype.</span>getLocal
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.keys.prototype.readFile">
            function <span class="apidocSignatureSpan">deployd.keys.prototype.</span>readFile
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.keys.prototype.writeFile">
            function <span class="apidocSignatureSpan">deployd.keys.prototype.</span>writeFile
            <span class="apidocSignatureSpan">(data, fn)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.mongod">module deployd.mongod</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.mongod.restart">
            function <span class="apidocSignatureSpan">deployd.mongod.</span>restart
            <span class="apidocSignatureSpan">(mongod, env, port, fn)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.resource">module deployd.resource</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.resource.resource">
            function <span class="apidocSignatureSpan">deployd.</span>resource
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.resource.super_">
            function <span class="apidocSignatureSpan">deployd.resource.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.resource.toJSON">
            function <span class="apidocSignatureSpan">deployd.resource.</span>toJSON
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.resource.</span>external</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.resource.prototype">module deployd.resource.prototype</a><ol>

        <li>

            <span class="apidocSignatureSpan">boolean <span class="apidocSignatureSpan">deployd.resource.prototype.</span>__resource__</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">boolean <span class="apidocSignatureSpan">deployd.resource.prototype.</span>clientGeneration</span>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.resource.prototype.handle">
            function <span class="apidocSignatureSpan">deployd.resource.prototype.</span>handle
            <span class="apidocSignatureSpan">(ctx, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.resource.prototype.load">
            function <span class="apidocSignatureSpan">deployd.resource.prototype.</span>load
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.resource.prototype.parse">
            function <span class="apidocSignatureSpan">deployd.resource.prototype.</span>parse
            <span class="apidocSignatureSpan">(url)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.resource.prototype.</span>clientGenerationExec</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.resource.prototype.</span>clientGenerationGet</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.router">module deployd.router</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.router.router">
            function <span class="apidocSignatureSpan">deployd.</span>router
            <span class="apidocSignatureSpan">(resources, server)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.router.prototype">module deployd.router.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.router.prototype.generateRegex">
            function <span class="apidocSignatureSpan">deployd.router.prototype.</span>generateRegex
            <span class="apidocSignatureSpan">(path)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.router.prototype.matchResources">
            function <span class="apidocSignatureSpan">deployd.router.prototype.</span>matchResources
            <span class="apidocSignatureSpan">(url)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.router.prototype.route">
            function <span class="apidocSignatureSpan">deployd.router.prototype.</span>route
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.script">module deployd.script</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.script.script">
            function <span class="apidocSignatureSpan">deployd.</span>script
            <span class="apidocSignatureSpan">(src, path)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.script.load">
            function <span class="apidocSignatureSpan">deployd.script.</span>load
            <span class="apidocSignatureSpan">(path, fn)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.script.prototype">module deployd.script.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.script.prototype.getFunction">
            function <span class="apidocSignatureSpan">deployd.script.prototype.</span>getFunction
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.script.prototype.run">
            function <span class="apidocSignatureSpan">deployd.script.prototype.</span>run
            <span class="apidocSignatureSpan">(ctx, domain, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.script.prototype.runWithContext">
            function <span class="apidocSignatureSpan">deployd.script.prototype.</span>runWithContext
            <span class="apidocSignatureSpan">(context)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.server">module deployd.server</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.server.server">
            function <span class="apidocSignatureSpan">deployd.</span>server
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.server.super_">
            function <span class="apidocSignatureSpan">deployd.server.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.server.prototype">module deployd.server.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.server.prototype.createStore">
            function <span class="apidocSignatureSpan">deployd.server.prototype.</span>createStore
            <span class="apidocSignatureSpan">(namespace)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.server.prototype.handleRequest">
            function <span class="apidocSignatureSpan">deployd.server.prototype.</span>handleRequest
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.server.prototype.listen">
            function <span class="apidocSignatureSpan">deployd.server.prototype.</span>listen
            <span class="apidocSignatureSpan">(port, host)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.server.prototype.route">
            function <span class="apidocSignatureSpan">deployd.server.prototype.</span>route
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.session">module deployd.session</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.session.SessionStore">
            function <span class="apidocSignatureSpan">deployd.session.</span>SessionStore
            <span class="apidocSignatureSpan">(namespace, db, sockets, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.user_collection">module deployd.user_collection</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.user_collection.user_collection">
            function <span class="apidocSignatureSpan">deployd.</span>user_collection
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.user_collection.super_">
            function <span class="apidocSignatureSpan">deployd.user_collection.</span>super_
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">deployd.user_collection.</span>SALT_LEN</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.user_collection.</span>dashboard</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.user_collection.</span>events</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">deployd.user_collection.</span>defaultPath</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">deployd.user_collection.</span>label</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.user_collection.prototype">module deployd.user_collection.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.user_collection.prototype.checkHash">
            function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>checkHash
            <span class="apidocSignatureSpan">(uc, user, credentials)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.user_collection.prototype.getUserAndPasswordHash">
            function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>getUserAndPasswordHash
            <span class="apidocSignatureSpan">(user)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.user_collection.prototype.handle">
            function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>handle
            <span class="apidocSignatureSpan">(ctx)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.user_collection.prototype.handleLogin">
            function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>handleLogin
            <span class="apidocSignatureSpan">(ctx)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.user_collection.prototype.handleSession">
            function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>handleSession
            <span class="apidocSignatureSpan">(ctx, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.user_collection.prototype.hash">
            function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>hash
            <span class="apidocSignatureSpan">(password, salt)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.user_collection.prototype.loginFindUser">
            function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>loginFindUser
            <span class="apidocSignatureSpan">(ctx, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.user_collection.prototype.setPassword">
            function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>setPassword
            <span class="apidocSignatureSpan">(body)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.user_collection.prototype.setSessionId">
            function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>setSessionId
            <span class="apidocSignatureSpan">(ctx, sessionId)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>clientGenerationExec</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>clientGenerationGet</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.deployd.uuid">module deployd.uuid</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.deployd.uuid.create">
            function <span class="apidocSignatureSpan">deployd.uuid.</span>create
            <span class="apidocSignatureSpan">(length)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd" id="apidoc.module.deployd">module deployd</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.deployd" id="apidoc.element.deployd.deployd">
        function <span class="apidocSignatureSpan"></span>deployd
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">deployd = function (config) {
  var server = new Server(config);
  upgrade(server);
  return server;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.attach" id="apidoc.element.deployd.attach">
        function <span class="apidocSignatureSpan">deployd.</span>attach
        <span class="apidocSignatureSpan">(httpServer, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function attach(httpServer, options) {
  var server = process.server = httpServer;

  // defaults
  server.options = options = _.extend({
    db: {port: 27017, host: '127.0.0.1', name: 'deployd'}
  }, options);

  debug('started with options %j', options);

  // an object to map a server to its stores
  server.stores = {};

  // back all memory stores with a db
  server.db = db.create(options.db);

  // use socket io for a session based realtime channel
  if (options.socketIo &amp;&amp; options.socketIo.sockets) {
    server.sockets = options.socketIo.sockets;
  } else {
    var socketIo = require('socket.io').listen(server, {'log level':0});
    server.sockets = socketIo.sockets;
  }

  // persist sessions in a store
  server.sessions = new SessionStore('sessions', server.db, server.sockets, options.sessions);

  // persist keys in a store
  server.keys = new Keys();

  server.handleRequest = function handleRequest(req, res) {
    // dont handle socket.io requests
    if(req.url.indexOf('/socket.io/') === 0) return;
    debug('%s %s', req.method, req.url);

    // add utilites to req and res
    setupReqRes(server.options, req, res, function(err, next) {
      if(err) return res.end(err.message);

      var authToken, usesBearerAuth = false;
      if (req.headers &amp;&amp; req.headers.authorization) {
        var parts = req.headers.authorization.split(' ');
        var scheme = parts[0]
        , credentials = parts[1];

        if (/^Bearer$/i.test(scheme)) {
          authToken = credentials;
          usesBearerAuth = true;
        }
      }

      server.sessions.createSession(authToken || req.cookies.get('sid'), function(err, session) {

        if(err) {
          debug('session error', err, session);
          throw err;
        } else {
          if (!usesBearerAuth) {
            // (re)set the session id cookie if we're not using Authorization Bearer
            req.cookies.set('sid', session.sid);
          }
          req.session = session;

          var root = req.headers['dpd-ssh-key'] || req.cookies.get('DpdSshKey');

          if (server.options.env === 'development') {
            if (root) {
              req.isRoot = true;
            }
            server.route(req, res);
          } else if (root) {
            // all root requests
            // must be authenticated
            debug('authenticating', root);
            server.keys.get(root, function(err, key) {
              if(err) throw err;
              if(key) req.isRoot = true;
              debug('is root?', session.isRoot);
              server.route(req, res);
            });
          } else {
            // normal route
            server.route(req, res);
          }
        }
      });
    });
  };


  var serverpath = server.options.server_dir || fs.realpathSync('./');

  // mkdir resourcesPath if not exists
  var resourcesPath = path.join(serverpath, 'resources');
  // use sync functions, as only run once when server start-up
  if (!fs.existsSync(resourcesPath)) {
    fs.mkdirSync(resourcesPath);
  }

  server.route = function route(req, res) {
    config.loadConfig(serverpath, server, function(err, resourcesInstances) {
      if (err) throw err;
      server.resources = resourcesInstances;
      var router = server.router = new Router(resourcesInstances, server);
      router.route(req, res);
    });
  };

  // lazy-load OR bootstrap load?
  // config.loadConfig('./', server, function(err, resourcesInstances) {
  //     if (err) {
  //         console.error();
  //         console.error("Error loading resources: ");
  //         console.error(err.stack || err);
  //         process.exit(1);
  //     } else {
  //         server.resources = resourcesInstances;
  //         var router = server.router = new Router(resourcesInstances, server);
  //     }
  // });


  server.on('request:error', function (err, req, res) {
    console.error();
    console.error(req.method, req.url, err.stack || err);
    process.exit(1);
  });




  /**
  * Create a new `Store` for persisting data using the database info that was passed to the server when it was create ...</pre></li>
    <li>example usage<pre class="apidocCodePre">...
*   var http = require('http');
*   var express = require('express');
*   var app = express();
*   var server = http.createServer(app);
*   var io = require('socket.io').listen(server, {'log level': 0});
*
*   var deployd = require('deployd')
*   deployd.<span class="apidocCodeKeywordSpan">attach</span>(server, {socketIo: io, env: ENV, db:{host:'localhost', port
:27015, name:'my-db'} } );
*   app.use(server.handleRequest);
*
*   server.listen();
*
* @param {Object} options
* @return {HttpServer}
*/
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.client_js" id="apidoc.element.deployd.client_js">
        function <span class="apidocSignatureSpan">deployd.</span>client_js
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ClientLib(name, options) {
  Resource.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.context" id="apidoc.element.deployd.context">
        function <span class="apidocSignatureSpan">deployd.</span>context
        <span class="apidocSignatureSpan">(resource, req, res, server)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Context(resource, req, res, server) {
  var ctx = this;
  this.url = req.url.slice(resource.path.length).split('?')[0];
  if (this.url.indexOf('/') !== 0) this.url = '/' + this.url;

  this.req = req;
  this.res = res;
  this.body = req.body;
  this.query = req.query || {};
  this.server = server;
  this.session = req.session;
  this.method = req &amp;&amp; req.method;

  // always bind done to this
  var done = this.done;
  this.done = function() {
    done.apply(ctx, arguments);
  };

  if ((this.query &amp;&amp; typeof this.query.$limitRecursion !== 'undefined') || (this.body &amp;&amp; typeof this.body.$limitRecursion !== 'undefined
')) {
    var recursionLimit = this.query.$limitRecursion || this.body.$limitRecursion || 0;
    req.stack = req.stack || [];
    req.stack.recursionLimit = recursionLimit;
  }

  this.dpd = internalClient.build(server, req.session, req.stack, ctx);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.dashboard" id="apidoc.element.deployd.dashboard">
        function <span class="apidocSignatureSpan">deployd.</span>dashboard
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Dashboard() {
  // internal resource
  this.internal = true;

  this.loadTypes = async.memoize(this.loadTypes);
  this.loadLayout = async.memoize(this.loadLayout);

  Resource.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
dpd.on('error', onError);
dpd.listen();

function onListening () {
  console.info('listening on port', options.port);
  var commands = repl(dpd);
  if (program.dashboard) {
    commands.<span class="apidocCodeKeywordSpan">dashboard</span>();
  } else if (program.open) {
    commands.open();
  }
}

function onError (err) {
  if (err.code === "EADDRINUSE") {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.files" id="apidoc.element.deployd.files">
        function <span class="apidocSignatureSpan">deployd.</span>files
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Files(name, options) {
  Resource.apply(this, arguments);
  if(this.config.public) {
    this.public = this.config.public;
  } else {
    throw new Error('public root folder location required when creating a file resource');
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  var re = new RegExp('\\.(' + ext.join('|') + ')$');

  fs.readdirSync(dir)
  .filter(ignored)
  .forEach(function(path){
    path = join(dir, path);
    if (fs.statSync(path).isDirectory()) {
      exports.<span class="apidocCodeKeywordSpan">files</span>(path, ext, ret);
    } else if (path.match(re)) {
      ret.push(path);
    }
  });

  return ret;
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.internal_resources" id="apidoc.element.deployd.internal_resources">
        function <span class="apidocSignatureSpan">deployd.</span>internal_resources
        <span class="apidocSignatureSpan">(settings, server)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function InternalResources(settings, server) {
  settings.configPath = settings.configPath || './';
  Resource.apply(this, arguments);
  this.server = server;
  // internal resource
  this.internal = true;
  debug('constructed');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.keys" id="apidoc.element.deployd.keys">
        function <span class="apidocSignatureSpan">deployd.</span>keys
        <span class="apidocSignatureSpan">(path)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Keys(path) {
  this.path = path || '.dpd/keys.json';
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
*
* @param {Object} obj
* @return {Number}
* @api public
*/

exports.length = function(obj){
 return exports.<span class="apidocCodeKeywordSpan">keys</span>(obj).length;
};

/**
* Check if `obj` is empty.
*
* @param {Object} obj
* @return {Boolean}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.resource" id="apidoc.element.deployd.resource">
        function <span class="apidocSignatureSpan">deployd.</span>resource
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Resource(name, options) {
  EventEmitter.call(this);
  this.name = name;
  this.path = '/' + name;
  options = this.options = options || {};
  this.config = options.config || {};
  this.events = {};
  var instance = this;
  if(this.constructor.external) {
    instance.external = {};
    Object.keys(this.constructor.external).forEach(function (key) {
      if(typeof instance.constructor.external[key] == 'function') {
        instance.external[key] = function () {
          instance.constructor.external[key].apply(instance, arguments);
        };
      }
    });
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.router" id="apidoc.element.deployd.router">
        function <span class="apidocSignatureSpan">deployd.</span>router
        <span class="apidocSignatureSpan">(resources, server)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Router(resources, server) {
  this.resources = resources || [];
  this.server = server;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.script" id="apidoc.element.deployd.script">
        function <span class="apidocSignatureSpan">deployd.</span>script
        <span class="apidocSignatureSpan">(src, path)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Script(src, path) {
  this.scriptSourceCode = src;
  this.path = path;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.server" id="apidoc.element.deployd.server">
        function <span class="apidocSignatureSpan">deployd.</span>server
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Server(options) {
  var server = process.server = this;
  http.Server.call(this);

  // defaults
  this.options = options = extend({
    port: 2403,
    db: {port: 27017, host: '127.0.0.1', name: 'deployd'}
  }, options);

  debug('started with options %j', options);

  // an object to map a server to its stores
  this.stores = {};

  // back all memory stores with a db
  this.db = db.create(options.db);

  var socketServer = io.listen(this, _.extend({
    'log level': 0
  }, (this.options.socketIo &amp;&amp; this.options.socketIo.options) || {}));

  // use socket io for a session based realtime channel
  this.sockets = socketServer.sockets;

  if (this.options.socketIo &amp;&amp; this.options.socketIo.adapter) {
    socketServer.adapter(this.options.socketIo.adapter);
  }

  // persist sessions in a store
  this.sessions = new SessionStore('sessions', this.db, this.sockets, options.sessions);

  // persist keys in a store
  this.keys = new Keys();

  this.on('request', server.handleRequest);

  server.on('request:error', function (err, req, res) {
    console.error();
    console.error(req.method, req.url, err.stack || err);
    process.exit(1);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.user_collection" id="apidoc.element.deployd.user_collection">
        function <span class="apidocSignatureSpan">deployd.</span>user_collection
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function UserCollection(name, options) {
  Collection.apply(this, arguments);

  if(!this.properties) {
    this.properties = {};
  }

  // username and password are required
  this.properties.username = this.properties.username || {type: 'string'};
  this.properties.username.required = true;
  this.properties.password = this.properties.password || {type: 'string'};
  this.properties.password.required = true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>








































</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.ayepromise" id="apidoc.module.deployd.ayepromise">module deployd.ayepromise</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.ayepromise.defer" id="apidoc.element.deployd.ayepromise.defer">
        function <span class="apidocSignatureSpan">deployd.ayepromise.</span>defer
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">defer = function () {
    var state = PENDING,
        outcome,
        thenHandlers = [];

    var doSettle = function (settledState, value) {
        state = settledState;
        // persist for handlers registered after settling
        outcome = value;

        thenHandlers.forEach(function (then) {
            then.handle(state, outcome);
        });

        // Discard all references to handlers to be garbage collected
        thenHandlers = null;
    };

    var doFulfill = function (value) {
        doSettle(FULFILLED, value);
    };

    var doReject = function (error) {
        doSettle(REJECTED, error);
    };

    var registerThenHandler = function (onFulfilled, onRejected) {
        var thenHandler = aThenHandler(onFulfilled, onRejected);

        if (state === PENDING) {
            thenHandlers.push(thenHandler);
        } else {
            thenHandler.handle(state, outcome);
        }

        return thenHandler.promise;
    };

    var safelyResolveThenable = function (thenable) {
        // Either fulfill, reject or reject with error
        var onceWrapper = once();
        try {
            thenable(
                onceWrapper(transparentlyResolveThenablesAndSettle),
                onceWrapper(doReject)
            );
        } catch (e) {
            onceWrapper(doReject)(e);
        }
    };

    var transparentlyResolveThenablesAndSettle = function (value) {
        var thenable;

        try {
            thenable = getThenableIfExists(value);
        } catch (e) {
            doReject(e);
            return;
        }

        if (thenable) {
            safelyResolveThenable(thenable);
        } else {
            doFulfill(value);
        }
    };

    var onceWrapper = once();
    return {
        resolve: onceWrapper(transparentlyResolveThenablesAndSettle),
        reject: onceWrapper(doReject),
        promise: {
            then: registerThenHandler,
            fail: function (onRejected) {
                return registerThenHandler(null, onRejected);
            }
        }
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  return req.responseText;
}

}

function sendRequest(url,options) {
var req = createXMLHTTPObject();
var deferred = ayepromise.<span class="apidocCodeKeywordSpan">defer</span>();
if (!req) return Error("AJAX is somehow not supported");

if (options.query) url += '?' + options.query;

var data = options.data;
var method = options.method || "GET";
req.open(method,url,true);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.client_js" id="apidoc.module.deployd.client_js">module deployd.client_js</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.client_js.client_js" id="apidoc.element.deployd.client_js.client_js">
        function <span class="apidocSignatureSpan">deployd.</span>client_js
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ClientLib(name, options) {
  Resource.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.client_js.super_" id="apidoc.element.deployd.client_js.super_">
        function <span class="apidocSignatureSpan">deployd.client_js.</span>super_
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Resource(name, options) {
  EventEmitter.call(this);
  this.name = name;
  this.path = '/' + name;
  options = this.options = options || {};
  this.config = options.config || {};
  this.events = {};
  var instance = this;
  if(this.constructor.external) {
    instance.external = {};
    Object.keys(this.constructor.external).forEach(function (key) {
      if(typeof instance.constructor.external[key] == 'function') {
        instance.external[key] = function () {
          instance.constructor.external[key].apply(instance, arguments);
        };
      }
    });
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.client_js.prototype" id="apidoc.module.deployd.client_js.prototype">module deployd.client_js.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.client_js.prototype.generate" id="apidoc.element.deployd.client_js.prototype.generate">
        function <span class="apidocSignatureSpan">deployd.client_js.prototype.</span>generate
        <span class="apidocSignatureSpan">(res, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">generate = function (res, fn) {
  var clientLib = this;

  res.write('\n\n// automatically generated code\n\n');
  this.config.resources.forEach(function(r) {
    clientLib.generateResource(r, res);
  });
  fn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
};

/*!
 * Create a new key and save it in the keys file.
 */

Keys.prototype.create = function(fn) {
  var key = this.<span class="apidocCodeKeywordSpan">generate</span>()
, keys = this;

  this.readFile(function(err, data) {
if(err) return fn(err);

data[key] = true;
keys.writeFile(data, function(err) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.client_js.prototype.generateResource" id="apidoc.element.deployd.client_js.prototype.generateResource">
        function <span class="apidocSignatureSpan">deployd.client_js.prototype.</span>generateResource
        <span class="apidocSignatureSpan">(r, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">generateResource = function (r, res) {
  var jsName = r.path.replace(/[^A-Za-z0-9]/g, '')
    , i;

  if (r.clientGeneration &amp;&amp; jsName) {
    res.write('dpd.' + jsName + ' = dpd("' + r.path + '");\n');
    if (r.clientGenerationExec) {
      for (i = 0; i &lt; r.clientGenerationExec.length; i++) {
        res.write('dpd.' + jsName + '.' + r.clientGenerationExec[i] + ' = function(path, body, fn) {\n');
        res.write('  return dpd.' + jsName + '.exec("' + r.clientGenerationExec[i] + '", path, body, fn);\n');
        res.write('}\n');
      }
    }
    if (r.clientGenerationGet) {
      for (i = 0; i &lt; r.clientGenerationGet.length; i++) {
        res.write('dpd.' + jsName + '.' + r.clientGenerationGet[i] + ' = function(path, query, fn) {\n');
        res.write('  return dpd.' + jsName + '.get("' + r.clientGenerationGet[i] + '", path, query, fn);\n');
        res.write('}\n');
      }
    }
    // resource event namespacing sugar
    res.write('dpd.' + jsName + '.on = function(ev, fn) {\n');
    res.write('  return dpd.on("' + r.path.replace('/', '') + '" + ":" + ev, fn);\n');
    res.write('}\n');
    res.write('dpd.' + jsName + '.once = function(ev, fn) {\n');
    res.write('  return dpd.once("' + r.path.replace('/', '') + '" + ":" + ev, fn);\n');
    res.write('}\n');
    res.write('dpd.' + jsName + '.off = function(ev, fn) {\n');
    res.write('  return dpd.off("' + r.path.replace('/', '') + '" + ":" + ev, fn);\n');
    res.write('}\n');
  }

  if(r.external) {
    Object.keys(r.external).forEach(function (name) {
      res.write('dpd.' + jsName + '.' + name + ' = function (path, body, fn) {\n');
      res.write('  dpd.' + jsName + '.exec("' + name + '", path, body, fn);\n');
      res.write('}\n');
    });
  }

  res.write('\n');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
};

ClientLib.prototype.generate = function(res, fn) {
var clientLib = this;

res.write('\n\n// automatically generated code\n\n');
this.config.resources.forEach(function(r) {
  clientLib.<span class="apidocCodeKeywordSpan">generateResource</span>(r, res);
});
fn();
};

ClientLib.prototype.generateResource = function(r, res) {
var jsName = r.path.replace(/[^A-Za-z0-9]/g, '')
  , i;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.client_js.prototype.handle" id="apidoc.element.deployd.client_js.prototype.handle">
        function <span class="apidocSignatureSpan">deployd.client_js.prototype.</span>handle
        <span class="apidocSignatureSpan">(ctx, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">handle = function (ctx, next) {
  var resource = this;

  if (ctx.url === '/') {
    ctx.res.setHeader('Content-Type', 'text/javascript');
    var lib = resource.clientLib;

    ctx.res.write(lib);
    resource.generate(ctx.res, function() {
      ctx.res.end();
    });
  } else {
    next();
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var doSettle = function (settledState, value) {
    state = settledState;
    // persist for handlers registered after settling
    outcome = value;

    thenHandlers.forEach(function (then) {
        then.<span class="apidocCodeKeywordSpan">handle</span>(state, outcome);
    });

    // Discard all references to handlers to be garbage collected
    thenHandlers = null;
};

var doFulfill = function (value) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.client_js.prototype.load" id="apidoc.element.deployd.client_js.prototype.load">
        function <span class="apidocSignatureSpan">deployd.client_js.prototype.</span>load
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">load = function (fn) {
  var resource = this;

  async.parallel({
    dpdJs: function(callback) {
      fs.readFile(path.join(__dirname, '../../clib/dpd.js'), 'utf-8', callback);
    },
    socketIo: function(callback) {
      fs.readFile(path.join(__dirname, '../../clib/socket.io.min.js'), 'utf-8', callback);
    },
    promise: function(callback) {
      fs.readFile(path.join(__dirname, '../../clib/ayepromise.min.js'), 'utf-8', callback);
    },
    ajax: function(callback) {
      fs.readFile(path.join(__dirname, '../../clib/ajax.js'), 'utf-8', callback);
    }
  }, function(err, results) {
    if (err) return fn(err);
    var file = results.socketIo + "\n\n"
             + results.promise + "\n\n"
             + results.ajax + "\n\n"
             + results.dpdJs;
    resource.clientLib = file;
    fn();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}, fn);
}

function loadResourceExtras(resource, fn) {
async.series([
  function(fn) {
    if (resource.load) {
      resource.<span class="apidocCodeKeywordSpan">load</span>(fn);
    } else {
      fn();
    }
  }
], function(err) {
  fn(err, resource);
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.config_loader" id="apidoc.module.deployd.config_loader">module deployd.config_loader</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.config_loader.loadConfig" id="apidoc.element.deployd.config_loader.loadConfig">
        function <span class="apidocSignatureSpan">deployd.config_loader.</span>loadConfig
        <span class="apidocSignatureSpan">(basepath, server, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">loadConfig = function (basepath, server, fn) {
  var resources = server.__resourceCache || [];

  if (resources.length) {
    debug("Loading from cache");
    fn(null, resources);
    return;
  }

  var getTypes = async.memoize(loadTypes);

  async.waterfall([
      async.apply(loadResourceDir, basepath)
    , async.apply(loadResources, getTypes, basepath, server)
    , async.apply(addInternalResources, server, basepath)
  ], function(err, result) {
    if (server.options &amp;&amp; server.options.env !== 'development') {
      server.__resourceCache = result;
    }
    fn(err, result);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var resourcesPath = path.join(serverpath, 'resources');
// use sync functions, as only run once when server start-up
if (!fs.existsSync(resourcesPath)) {
  fs.mkdirSync(resourcesPath);
}

server.route = function route(req, res) {
  config.<span class="apidocCodeKeywordSpan">loadConfig</span>(serverpath, server, function(err, resourcesInstances) {
    if (err) throw err;
    server.resources = resourcesInstances;
    var router = server.router = new Router(resourcesInstances, server);
    router.route(req, res);
  });
};
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.context" id="apidoc.module.deployd.context">module deployd.context</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.context.context" id="apidoc.element.deployd.context.context">
        function <span class="apidocSignatureSpan">deployd.</span>context
        <span class="apidocSignatureSpan">(resource, req, res, server)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Context(resource, req, res, server) {
  var ctx = this;
  this.url = req.url.slice(resource.path.length).split('?')[0];
  if (this.url.indexOf('/') !== 0) this.url = '/' + this.url;

  this.req = req;
  this.res = res;
  this.body = req.body;
  this.query = req.query || {};
  this.server = server;
  this.session = req.session;
  this.method = req &amp;&amp; req.method;

  // always bind done to this
  var done = this.done;
  this.done = function() {
    done.apply(ctx, arguments);
  };

  if ((this.query &amp;&amp; typeof this.query.$limitRecursion !== 'undefined') || (this.body &amp;&amp; typeof this.body.$limitRecursion !== 'undefined
')) {
    var recursionLimit = this.query.$limitRecursion || this.body.$limitRecursion || 0;
    req.stack = req.stack || [];
    req.stack.recursionLimit = recursionLimit;
  }

  this.dpd = internalClient.build(server, req.session, req.stack, ctx);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.context.prototype" id="apidoc.module.deployd.context.prototype">module deployd.context.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.context.prototype.done" id="apidoc.element.deployd.context.prototype.done">
        function <span class="apidocSignatureSpan">deployd.context.prototype.</span>done
        <span class="apidocSignatureSpan">(err, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">done = function (err, res) {
  var body = res
    , type = 'application/json';

  // default response
  var status = this.res.statusCode = this.res.statusCode || 200;

  if(err) {
    debug('%j', err);
    if(status &lt; 400) this.res.statusCode = 400;
    if(err.statusCode) this.res.statusCode = err.statusCode;
    respond(err, this.req, this.res);
  } else {
    if(typeof body == 'object') {
      body = JSON.stringify(body);
    } else {
      type = 'text/html; charset=utf-8';
    }

    try {
      this.res.setHeader("Cache-Control", "no-cache, no-store, must-revalidate");
      this.res.setHeader("Pragma", "no-cache");
      this.res.setHeader("Expires", "0");
      if(status != 204 &amp;&amp; status != 304) {
        if(body) {
          this.res.setHeader('Content-Length', Buffer.isBuffer(body)
               ? body.length
               : Buffer.byteLength(body));
        }
        this.res.setHeader('Content-Type', type);
        this.res.end(body);
      } else {
        this.res.end();
      }
    } catch(e) {
      console.error(e);
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
   fn();
 }
};

/**
* Handle an incoming request. This gets called by the router.
* Call `next()` if the resource cannot handle the request.
* Otherwise call `cxt.<span class="apidocCodeKeywordSpan">done</span>(err, res)` when the resource
* is ready to respond.
*
* Example:
*
*  Override the handle method to return a string:
*
*     function MyResource(settings) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.context.prototype.end" id="apidoc.element.deployd.context.prototype.end">
        function <span class="apidocSignatureSpan">deployd.context.prototype.</span>end
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">end = function () {
  return this.res.end.apply(this.res, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  server.handleRequest = function handleRequest(req, res) {
    // dont handle socket.io requests
    if(req.url.indexOf('/socket.io/') === 0) return;
    debug('%s %s', req.method, req.url);

    // add utilites to req and res
    setupReqRes(server.options, req, res, function(err, next) {
if(err) return res.<span class="apidocCodeKeywordSpan">end</span>(err.message);

var authToken, usesBearerAuth = false;
if (req.headers &amp;&amp; req.headers.authorization) {
  var parts = req.headers.authorization.split(' ');
  var scheme = parts[0]
  , credentials = parts[1];
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.dashboard" id="apidoc.module.deployd.dashboard">module deployd.dashboard</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.dashboard.dashboard" id="apidoc.element.deployd.dashboard.dashboard">
        function <span class="apidocSignatureSpan">deployd.</span>dashboard
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Dashboard() {
  // internal resource
  this.internal = true;

  this.loadTypes = async.memoize(this.loadTypes);
  this.loadLayout = async.memoize(this.loadLayout);

  Resource.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
dpd.on('error', onError);
dpd.listen();

function onListening () {
  console.info('listening on port', options.port);
  var commands = repl(dpd);
  if (program.dashboard) {
    commands.<span class="apidocCodeKeywordSpan">dashboard</span>();
  } else if (program.open) {
    commands.open();
  }
}

function onError (err) {
  if (err.code === "EADDRINUSE") {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.dashboard.super_" id="apidoc.element.deployd.dashboard.super_">
        function <span class="apidocSignatureSpan">deployd.dashboard.</span>super_
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Resource(name, options) {
  EventEmitter.call(this);
  this.name = name;
  this.path = '/' + name;
  options = this.options = options || {};
  this.config = options.config || {};
  this.events = {};
  var instance = this;
  if(this.constructor.external) {
    instance.external = {};
    Object.keys(this.constructor.external).forEach(function (key) {
      if(typeof instance.constructor.external[key] == 'function') {
        instance.external[key] = function () {
          instance.constructor.external[key].apply(instance, arguments);
        };
      }
    });
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.dashboard.prototype" id="apidoc.module.deployd.dashboard.prototype">module deployd.dashboard.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.dashboard.prototype.handle" id="apidoc.element.deployd.dashboard.prototype.handle">
        function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>handle
        <span class="apidocSignatureSpan">(ctx, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">handle = function (ctx, next) {

  if (ctx.req.url === this.path) {
    return httpUtil.redirect(ctx.res, ctx.req.url + '/');
  } else if (ctx.url === '/__is-root') {
    ctx.done(null, {isRoot: ctx.req.isRoot});
  } else if (ctx.url.indexOf('/__custom') === 0) {
    this.serveCustomAsset(ctx, next);
  } else if (ctx.url.indexOf('.') !== -1) {
    filed(path.join(__dirname, 'dashboard', ctx.url)).pipe(ctx.res);
  } else if (!ctx.req.isRoot &amp;&amp; (!ctx.server.options || ctx.server.options.env !== 'development')) {
    filed(path.join(__dirname, 'dashboard', 'auth.html')).pipe(ctx.res);
  } else {
    this.render(ctx);
  }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var doSettle = function (settledState, value) {
    state = settledState;
    // persist for handlers registered after settling
    outcome = value;

    thenHandlers.forEach(function (then) {
        then.<span class="apidocCodeKeywordSpan">handle</span>(state, outcome);
    });

    // Discard all references to handlers to be garbage collected
    thenHandlers = null;
};

var doFulfill = function (value) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.dashboard.prototype.loadAdvancedDashboard" id="apidoc.element.deployd.dashboard.prototype.loadAdvancedDashboard">
        function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>loadAdvancedDashboard
        <span class="apidocSignatureSpan">(data, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">loadAdvancedDashboard = function (data, fn) {
  var pagePath = data.pagePath
    , dashboardPath = data.dashboardPath
    , page = data.page
    , resourceType = data.resourceType
    , options = data.options;


  async.parallel({
    bodyHtml: function(fn) {
      fs.readFile(pagePath, 'utf-8', fn);
    },

    scripts: function(fn) {
      if (resourceType.dashboard.scripts) {
        resourceType.dashboard.scripts.forEach(function(s) {
          options.scripts.push('/__custom/' + resourceType.name.toLowerCase() + s);
        });
      }

      fs.exists(path.join(dashboardPath, 'js', page + '.js'), function(exists) {
        if (exists) {
          options.scripts.push('/__custom/' + resourceType.name.toLowerCase() + '/js/' + page + '.js');
        }

        fn();
      });
    },

    stylesheet: function(fn) {
      fs.exists(path.join(resourceType.dashboard.path, 'style.css'), function(exists) {
        if (exists) {
          options.css = '/__custom/' + resourceType.name.toLowerCase() + '/style.css';
        }

        fn();
      });
    }
  }, function(err, results) {
    if (err) return fn(err);

    options.bodyHtml = results.bodyHtml;

    if (page === 'index') page = 'config';
    options.page = page;

    fn(null, options);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  } else {
    fn(null, false);
  }
},

function(exists, fn) {
  if (exists) {
    self.<span class="apidocCodeKeywordSpan">loadAdvancedDashboard</span>({
        pagePath: pagePath
      , dashboardPath: dashboardPath
      , page: page
      , resourceType: resourceType
      , options: options
    }, fn);
  } else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.dashboard.prototype.loadBasicDashboard" id="apidoc.element.deployd.dashboard.prototype.loadBasicDashboard">
        function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>loadBasicDashboard
        <span class="apidocSignatureSpan">(data, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">loadBasicDashboard = function (data, fn) {
  var options = data.options
    , page = data.page
    , resourceType = data.resourceType
    , dashboardPath = path.join(__dirname, 'dashboard');

  options.page = page;
  if (page === 'index') {
    options.page = 'config';
    if (resourceType.basicDashboard) {
      options.scripts.push('/js/basic.js');
      options.basicDashboard = resourceType.basicDashboard;
      fs.readFile(path.join(dashboardPath, 'basic.html'), function(err, bodyHtml) {
        options.bodyHtml = bodyHtml;
        fn(err);
      });
    } else {
      options.scripts.push('/js/default.js');
      fs.readFile(path.join(dashboardPath, 'default.html'), function(err, bodyHtml) {
        options.bodyHtml = bodyHtml;
        fn(err);
      });
    }
  } else if (page === 'events') {
    fs.readFile(path.join(dashboardPath, 'events.html'), function(err, bodyHtml) {
      options.bodyHtml = bodyHtml;
      fn(err);
    });
  } else {
    return fn();
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
          pagePath: pagePath
        , dashboardPath: dashboardPath
        , page: page
        , resourceType: resourceType
        , options: options
      }, fn);
    } else {
      self.<span class="apidocCodeKeywordSpan">loadBasicDashboard</span>({
          options: options
        , page: page
        , resourceType: resourceType
      }, fn);
    }
  }
], function(err) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.dashboard.prototype.loadLayout" id="apidoc.element.deployd.dashboard.prototype.loadLayout">
        function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>loadLayout
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">loadLayout = function (fn) {

  fs.readFile(path.join(__dirname, 'dashboard', 'index.ejs'), 'utf-8', function(err, layout) {
    if (err) return fn(err);
    var layoutTemplate = ejs.compile(layout, {delimiter:'?'}); //Avoid conlicts by using non-standard tags
    fn(null, layoutTemplate);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.dashboard.prototype.loadPage" id="apidoc.element.deployd.dashboard.prototype.loadPage">
        function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>loadPage
        <span class="apidocSignatureSpan">(ctx, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">loadPage = function (ctx, fn) {
  var parts = ctx.url.split('/').filter(function(p) { return p; })
    , resourceId
    , resource
    , resourceType
    , options = {}
    , self = this
    , dashboardPath
    , pagePath;

  if (parts.length) {
    resourceId = parts[0];
    resource = ctx.server.resources.filter(function(r) { return r.name === resourceId.toLowerCase() })[0];

    if (resource) {
      options.resourceId = resourceId;
      resourceType = resource.constructor;
      options.resourceType = resourceType.name;
      options.events = resourceType.events;
      options.scripts = [];

      var page = parts[1];

      if (!page &amp;&amp; resourceType.dashboard &amp;&amp; resourceType.dashboard.pages) {
        page = resourceType.dashboard.pages[0];
      } else if (!page) {
        page = 'index';
      }
      if (page === 'config') page = 'index';

      dashboardPath = resourceType.dashboard &amp;&amp; resourceType.dashboard.path;

      async.waterfall([
        function(fn) {
          if (dashboardPath) {
            pagePath = path.join(dashboardPath, page + '.html');
            fs.exists(pagePath, function(exists) {
              fn(null, exists);
            });
          } else {
            fn(null, false);
          }
        },

        function(exists, fn) {
          if (exists) {
            self.loadAdvancedDashboard({
                pagePath: pagePath
              , dashboardPath: dashboardPath
              , page: page
              , resourceType: resourceType
              , options: options
            }, fn);
          } else {
            self.loadBasicDashboard({
                options: options
              , page: page
              , resourceType: resourceType
            }, fn);
          }
        }
      ], function(err) {
        fn(err, options);
      });

      debug("Editing resource %s of type %s", resourceId, resourceType.name);

      return;
    }
  }

  fn(); //blank page
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.dashboard.prototype.loadTypes" id="apidoc.element.deployd.dashboard.prototype.loadTypes">
        function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>loadTypes
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">loadTypes = function (fn) {
  loadTypes(function(defaults, types) {
    Object.keys(defaults).forEach(function(key) {
      types[key] = defaults[key];
    });
    fn(null, types);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

afterEach(function() {
  if (fs.existsSync(basepath)) {
      sh.rm('-rf', basepath);
    }
});

describe('.<span class="apidocCodeKeywordSpan">loadTypes</span>(basepath, fn)', function() {
  var createPackageJson = function(opts) {
    if (fs.existsSync(basepath)) {
      sh.rm('-rf', basepath);
    }
    sh.mkdir('-p', basepath);
    sh.cp('./lib/resource.js', basepath + '/resource.js');
    sh.cp('./lib/script.js', basepath + '/script.js');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.dashboard.prototype.render" id="apidoc.element.deployd.dashboard.prototype.render">
        function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>render
        <span class="apidocSignatureSpan">(ctx)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">render = function (ctx) {
  var self = this
    , appName = path.basename(path.resolve('./'))
    , env = ctx.server &amp;&amp; ctx.server.options &amp;&amp; ctx.server.options.env;

  async.parallel({
      layout: self.loadLayout
    , options: async.apply(self.loadPage.bind(self), ctx)
  }, function(err, results) {
    if (err) return ctx.done(err);

    var options = results.options || {}
      , layout = results.layout
      , render = {};

    var context = {
        resourceId: options.resourceId
      , resourceType: options.resourceType
      , page: options.page
      , basicDashboard: options.basicDashboard
      , events: options.events
      , appName: appName
      , env: env
    };

    render.bodyHtml = options.bodyHtml;

    try {
      var rendered = layout({context: context, render: render, scripts: options.scripts || [], css: options.css || null});
      ctx.res.setHeader('Content-Type', 'text/html; charset=UTF-8');
      ctx.res.end(rendered);
    } catch (ex) {
      ctx.done(ex.message);
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
} else if (ctx.url.indexOf('/__custom') === 0) {
  this.serveCustomAsset(ctx, next);
} else if (ctx.url.indexOf('.') !== -1) {
  filed(path.join(__dirname, 'dashboard', ctx.url)).pipe(ctx.res);
} else if (!ctx.req.isRoot &amp;&amp; (!ctx.server.options || ctx.server.options.env !== 'development')) {
  filed(path.join(__dirname, 'dashboard', 'auth.html')).pipe(ctx.res);
} else {
  this.<span class="apidocCodeKeywordSpan">render</span>(ctx);
}

};


Dashboard.prototype.serveCustomAsset = function(ctx, next) {
var parts = ctx.url.split('/').filter(function(p) { return p; })
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.dashboard.prototype.serveCustomAsset" id="apidoc.element.deployd.dashboard.prototype.serveCustomAsset">
        function <span class="apidocSignatureSpan">deployd.dashboard.prototype.</span>serveCustomAsset
        <span class="apidocSignatureSpan">(ctx, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">serveCustomAsset = function (ctx, next) {
  var parts = ctx.url.split('/').filter(function(p) { return p; })
    , resourceTypePath = parts[1]
    , resource = this;

  resource.loadTypes(function(err, types) {
    var resourceTypeId
      , resourceType
      , dashboardPath
      , reqUrl = parts.slice(2).join('/');

    resourceTypeId = Object.keys(types).filter(function(t) { return t.toLowerCase() === resourceTypePath; })[0];

    if (resourceTypeId) {
      resourceType = types[resourceTypeId];
      dashboardPath = resourceType &amp;&amp; resourceType.dashboard &amp;&amp; resourceType.dashboard.path;
      if (dashboardPath) {
        return filed(path.join(dashboardPath, reqUrl)).pipe(ctx.res);
      }
    }

    next();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Dashboard.prototype.handle = function(ctx, next) {

if (ctx.req.url === this.path) {
  return httpUtil.redirect(ctx.res, ctx.req.url + '/');
} else if (ctx.url === '/__is-root') {
  ctx.done(null, {isRoot: ctx.req.isRoot});
} else if (ctx.url.indexOf('/__custom') === 0) {
  this.<span class="apidocCodeKeywordSpan">serveCustomAsset</span>(ctx, next);
} else if (ctx.url.indexOf('.') !== -1) {
  filed(path.join(__dirname, 'dashboard', ctx.url)).pipe(ctx.res);
} else if (!ctx.req.isRoot &amp;&amp; (!ctx.server.options || ctx.server.options.env !== 'development')) {
  filed(path.join(__dirname, 'dashboard', 'auth.html')).pipe(ctx.res);
} else {
  this.render(ctx);
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.db" id="apidoc.module.deployd.db">module deployd.db</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.db.Db" id="apidoc.element.deployd.db.Db">
        function <span class="apidocSignatureSpan">deployd.db.</span>Db
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Db(options) {
  this.options = options;
  this.connectionString = this.options.connectionString;
  this.connectionOptions = this.options.connectionOptions || null;
  if (!this.connectionString &amp;&amp; this.options.host) {
    this.connectionString = url.format({
      protocol: "mongodb",
      slashes: true,
      hostname: this.options.host,
      port: this.options.port,
      auth: this.options.credentials ? this.options.credentials.username + ":" + this.options.credentials.password : null,
      pathname: this.options.name
    });
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
, db = require('../lib/db')
, config = require(__dirname + '/support/db-remote.config.json')
, tester = db.create(config)
, store = tester.createStore('test-store')
, assert = require('assert')
, mongodb = require('mongodb');

var mdb = new mongodb.<span class="apidocCodeKeywordSpan">Db</span>(config.name, new mongodb.Server(config.host, config.port));

before(function(done){
mdb.open(function (err) {
  if(err) {
    done(err);
  } else {
    mdb.removeUser(config.credentials.username, function (err) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.db.Store" id="apidoc.element.deployd.db.Store">
        function <span class="apidocSignatureSpan">deployd.db.</span>Store
        <span class="apidocSignatureSpan">(namespace, db)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Store(namespace, db) {
  this.namespace = namespace;
  this._db = db;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.db.create" id="apidoc.element.deployd.db.create">
        function <span class="apidocSignatureSpan">deployd.db.</span>create
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">create = function (options) {
  var db = new Db(options);
  return db;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
## 0.6.3

 - Removed dependency on jQuery for dpd.js
 - JSON-formatted "bad credentials" login error
 - Improved error reporting on CLI when port is in use
 - If in development mode, and no port has been specifically requested, CLI will retry with up to 5 different ports
 - Fixed "no open connections" bug on startup
 - Renamed `Db.connect()` to `Db.<span class="apidocCodeKeywordSpan">create</span>()`
 - Db connections are now lazy and only occur once a request is made
 - Added 500 and 404 error pages
 - Added module domain error handling for better module errors
 - Added automatic reloading on error
 - Dropped support for node 0.6

## 0.6.2
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.files" id="apidoc.module.deployd.files">module deployd.files</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.files.files" id="apidoc.element.deployd.files.files">
        function <span class="apidocSignatureSpan">deployd.</span>files
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Files(name, options) {
  Resource.apply(this, arguments);
  if(this.config.public) {
    this.public = this.config.public;
  } else {
    throw new Error('public root folder location required when creating a file resource');
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  var re = new RegExp('\\.(' + ext.join('|') + ')$');

  fs.readdirSync(dir)
  .filter(ignored)
  .forEach(function(path){
    path = join(dir, path);
    if (fs.statSync(path).isDirectory()) {
      exports.<span class="apidocCodeKeywordSpan">files</span>(path, ext, ret);
    } else if (path.match(re)) {
      ret.push(path);
    }
  });

  return ret;
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.files.super_" id="apidoc.element.deployd.files.super_">
        function <span class="apidocSignatureSpan">deployd.files.</span>super_
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Resource(name, options) {
  EventEmitter.call(this);
  this.name = name;
  this.path = '/' + name;
  options = this.options = options || {};
  this.config = options.config || {};
  this.events = {};
  var instance = this;
  if(this.constructor.external) {
    instance.external = {};
    Object.keys(this.constructor.external).forEach(function (key) {
      if(typeof instance.constructor.external[key] == 'function') {
        instance.external[key] = function () {
          instance.constructor.external[key].apply(instance, arguments);
        };
      }
    });
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.files.prototype" id="apidoc.module.deployd.files.prototype">module deployd.files.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.files.prototype.handle" id="apidoc.element.deployd.files.prototype.handle">
        function <span class="apidocSignatureSpan">deployd.files.prototype.</span>handle
        <span class="apidocSignatureSpan">(ctx, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">handle = function (ctx, next) {
  if(ctx.req &amp;&amp; ctx.req.method !== 'GET') return next();

  send(ctx.req, url.parse(ctx.url).pathname, {root: path.resolve(this.public)})
    .on('error', function (err) {
      ctx.res.statusCode = 404;
      respond('Resource Not Found', ctx.req, ctx.res);
    })
    .pipe(ctx.res);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var doSettle = function (settledState, value) {
    state = settledState;
    // persist for handlers registered after settling
    outcome = value;

    thenHandlers.forEach(function (then) {
        then.<span class="apidocCodeKeywordSpan">handle</span>(state, outcome);
    });

    // Discard all references to handlers to be garbage collected
    thenHandlers = null;
};

var doFulfill = function (value) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.http" id="apidoc.module.deployd.http">module deployd.http</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.http.getBody" id="apidoc.element.deployd.http.getBody">
        function <span class="apidocSignatureSpan">deployd.http.</span>getBody
        <span class="apidocSignatureSpan">(req, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getBody = function (req, callback){
  if(req.rawBody) {
    return callback(req.rawBody);
  }

  var buf = '';

  req.on('data', function(chunk){ buf += chunk; });

  req.on('end', function(){
    return callback(buf);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  it('should get body from stream', function(done){

var obj = JSON.stringify({foo: 'bar'})
  , req = new Stream();

var res = this.res;

http.<span class="apidocCodeKeywordSpan">getBody</span>(req, function(buffer) {
  console.error('STREAM', buffer, typeof buffer);
  expect(buffer).to.exist;
  expect(buffer).to.eql(obj);
  done();
});

req.emit('data', obj);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.http.parseBody" id="apidoc.element.deployd.http.parseBody">
        function <span class="apidocSignatureSpan">deployd.http.</span>parseBody
        <span class="apidocSignatureSpan">(req, res, mime, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">parseBody = function (req, res, mime, callback) {
  exports.getBody(req, function(buf){

    var parser = JSON;

    if (mime === 'application/x-www-form-urlencoded') {
      parser = qs;
    }

    try {
      if(buf.length) {
        if(mime === 'application/json' &amp;&amp; '{' != buf[0] &amp;&amp; '[' != buf[0]) {
          res.setHeader('Content-Type', 'text/plain');
          res.statusCode = 400;
          res.end('Could not parse invalid JSON');
          return;
        }

        req.body = parser.parse(buf);
        var m = req.body._method;
        if ( m ) {
          req.originalMethod = req.method;
          req.method = m.toUpperCase();
          delete req.body._method;
        }
      } else {
        req.body = {};
      }
      callback();
    } catch (ex) {
      res.setHeader('Content-Type', 'text/plain');
      res.statusCode = 400;
      res.end('Failed to parse body as ' + mime);
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  req.emit('data', obj);
  req.emit('end');

});

});

describe('.<span class="apidocCodeKeywordSpan">parseBody</span>()', function() {
beforeEach(function () {
  this.res = {
    setHeader: function () {

    }
  };
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.http.parseQuery" id="apidoc.element.deployd.http.parseQuery">
        function <span class="apidocSignatureSpan">deployd.http.</span>parseQuery
        <span class="apidocSignatureSpan">(url)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">parseQuery = function (url) {
  var q = url.substr(url.indexOf('?') + 1);

  if(q) q = decodeURIComponent(q);

  if(q[0] === '{' &amp;&amp; q[q.length - 1] === '}') {
    return JSON.parse(q);
  } else {
    var parsedQuery = qs.parse(parseUrl(url).query);
    if (parsedQuery._jsonquery) {
      return JSON.parse(parsedQuery._jsonquery);
    }

    return parseNumbersInObject(parsedQuery);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
		}
	});
});

describe('http', function() {
	describe('.parseQuery', function() {
		it('should parse a query string', function() {
			var q = http.<span class="apidocCodeKeywordSpan">parseQuery</span>('/foo/bar?foo=bar');
			expect(q).to.eql({foo:'bar'});
		});

		it('should parse a json query string', function() {
			var q = http.parseQuery('/foo/bar?{"foo":"bar"}');
			expect(q).to.eql({foo:'bar'});
		});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.http.redirect" id="apidoc.element.deployd.http.redirect">
        function <span class="apidocSignatureSpan">deployd.http.</span>redirect
        <span class="apidocSignatureSpan">(res, url, statusCode)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">redirect = function (res, url, statusCode) {
  res.statusCode = statusCode || 301;
  res.setHeader("Location", url);
  res.end();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
module.exports = Dashboard;



Dashboard.prototype.handle = function(ctx, next) {

if (ctx.req.url === this.path) {
  return httpUtil.<span class="apidocCodeKeywordSpan">redirect</span>(ctx.res, ctx.req.url + '/');
} else if (ctx.url === '/__is-root') {
  ctx.done(null, {isRoot: ctx.req.isRoot});
} else if (ctx.url.indexOf('/__custom') === 0) {
  this.serveCustomAsset(ctx, next);
} else if (ctx.url.indexOf('.') !== -1) {
  filed(path.join(__dirname, 'dashboard', ctx.url)).pipe(ctx.res);
} else if (!ctx.req.isRoot &amp;&amp; (!ctx.server.options || ctx.server.options.env !== 'development')) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.http.setup" id="apidoc.element.deployd.http.setup">
        function <span class="apidocSignatureSpan">deployd.http.</span>setup
        <span class="apidocSignatureSpan">(options, req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setup = function (options, req, res, next) {
  var remoteHost = req.headers.origin
    , corsOpts = {supportsCredentials: true, methods: ALLOWED_METHODS, maxAge: 300};

  if(remoteHost) {
    corsOpts.origins = options.origins;
  } else {
    corsOpts.supportsCredentials = false;
  }
  corsOpts.responseHeaders = corser.simpleResponseHeaders.concat(["X-Session-Token", "X-Session-Invalidated"]).concat(options.allowedResponseHeaders
 || []);
  corsOpts.requestHeaders = corser.simpleRequestHeaders.concat(["X-Requested-With", "Authorization"]).concat(options.allowedRequestHeaders
 || []);
  if (options.allowCorsRootRequests) {
    corsOpts.requestHeaders.push("dpd-ssh-key");
  }

  var handler = corser.create(corsOpts);

  handler(req, res, function () {
    req.cookies = res.cookies = new Cookies(req, res);

    if(~req.url.indexOf('?')) {
      try {
        req.query = parseQuery(req.url);
        var m = req.query._method;
        if ( m ) {
            req.originalMethod = req.method;
            req.method = m.toUpperCase();
            delete req.query._method;
        }
      } catch (ex) {
        res.setHeader('Content-Type', 'text/plain');
        res.statusCode = 400;
        res.end('Failed to parse querystring: ' + ex);
        return;
      }
    }

    switch(req.method) {
      case 'OPTIONS':
        // End CORS preflight request.
        res.writeHead(204);
        res.end();
      break;
      case 'POST':
      case 'PUT':
      case 'DELETE':
        var mime = req.headers['content-type'] || 'application/json';
        mime = mime.split(';')[0]; //Just in case there's multiple mime types, pick the first

        if(autoParse[mime]) {
          autoParse[mime](req, res, mime, next);
        } else if(typeof options.mimeParser === 'function') {
          options.mimeParser(req, res, mime, next);
        } else {
          if(req.headers['content-length']) req.pause();
          next();
        }
      break;
      default:
        next();
      break;
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  &lt;script src="util.js"&gt;&lt;/script&gt;
  &lt;script src="sinon.js"&gt;&lt;/script&gt;
  &lt;script&gt;
  if (typeof initMochaPhantomJS === 'function') {
    initMochaPhantomJS()
  }
  &lt;/script&gt;
  &lt;script&gt;mocha.<span class="apidocCodeKeywordSpan">setup</span>('bdd')&lt;/script&gt;
  &lt;!-- -- tests -- --&gt;
  &lt;script src="test/util.test.js"&gt;&lt;/script&gt;
  &lt;script src="test/misc.test.js"&gt;&lt;/script&gt;
  &lt;script src="test/collection.test.js"&gt;&lt;/script&gt;
  &lt;script src="test/user-collection.test.js"&gt;&lt;/script&gt;
  &lt;script src="test/clientlib.test.js"&gt;&lt;/script&gt;
&lt;/head&gt;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.internal_client" id="apidoc.module.deployd.internal_client">module deployd.internal_client</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.internal_client.build" id="apidoc.element.deployd.internal_client.build">
        function <span class="apidocSignatureSpan">deployd.internal_client.</span>build
        <span class="apidocSignatureSpan">(server, session, stack, ctx)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">build = function (server, session, stack, ctx) {
  var baseMethods
    , dpd = {};

  baseMethods = {
    request: function(method, options, fn) {
      var promise = new Promise(function(resolve, reject) {
        var req
          , res
          , urlKey
          , recursions
          , recursionLimit;

        req = {
            url: joinPath('/', options.path)
          , method: method
          , query: options.query
          , body: options.body
          , session: session
          , isRoot: session &amp;&amp; session.isRoot
          , internal: true
          , headers: (ctx &amp;&amp; ctx.req) ? (ctx.req.headers || {}) : {}
          , connection: (ctx &amp;&amp; ctx.req) ? (ctx.req.connection || {}) : {}
          , on: function() {}
        };

        var callback = function(data, error) {
          // resolve or reject promise
          if (error) {
            reject(error);
          } else {
            resolve(data);
          }
        };

        urlKey = req.method + ' ' + req.url;

        req.stack = stack || [];
        debug("Stack: %j", stack);

        recursions = req.stack.filter(function(s) { return s === urlKey; }).length;

        recursionLimit = (stack &amp;&amp; stack.recursionLimit) || 2;

        if (recursions &lt; recursionLimit) {
          req.stack.push(urlKey);
          debug("Putting %s on stack", urlKey);

          res = {
            setHeader: function() {},
            end: function(data) {
              if (res.statusCode === 200 || res.statusCode === 204) {
                try {
                  callback(JSON.parse(data), null);
                } catch (ex) {
                  callback(data, null);
                }
              } else {
                try {
                  callback(null, JSON.parse(data));
                } catch (ex) {
                  callback(null, data);
                }
              }
            },
            internal: true,
            headers: {},
            on: function() {}
          };

          server.router.route(req, res);
        } else {
          debug("Recursive call detected - aborting");
          callback(null, "Recursive call to " + urlKey + " detected");
        }

      }).bind(this);

      if (typeof fn === 'function') {
        // call our old-style callback for backwards compatibility
        promise
          .then(function (data) {
            fn(data);
          }, function (error) {
            fn(null, error);
          });
      }

      return promise;
    }
  };

  baseMethods.get = function(options, fn) {
    return baseMethods.request.call(this, "GET", options, fn);
  };

  baseMethods.post = function(options, fn) {
    return baseMethods.request.call(this, "POST", options, fn);
  };

  baseMethods.put = function(options, fn) {
    return baseMethods.request.call(this, "PUT", options, fn);
  };

  baseMethods.del = function(options, fn) {
    return baseMethods.request.call(this, "DELETE", options, fn);
  };

  if (server.resources) {
    server.resources.forEach(function(r) {
      if (r.clientGeneration) {
        var jsName = r.path.replace(/[^A-Za-z0-9]/g, '');
        dpd[jsName] = createResourceClient(r, baseMethods);
      }
    });
  }

  return dpd;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

if ((this.query &amp;&amp; typeof this.query.$limitRecursion !== 'undefined') || (this.body &amp;&amp; typeof this
.body.$limitRecursion !== 'undefined')) {
  var recursionLimit = this.query.$limitRecursion || this.body.$limitRecursion || 0;
  req.stack = req.stack || [];
  req.stack.recursionLimit = recursionLimit;
}

this.dpd = internalClient.<span class="apidocCodeKeywordSpan">build</span>(server, req.session, req.stack, ctx);
}

/**
 * Alias for `ctx.res.end()`
 */
Context.prototype.end = function() {
return this.res.end.apply(this.res, arguments);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.internal_resources" id="apidoc.module.deployd.internal_resources">module deployd.internal_resources</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.internal_resources.internal_resources" id="apidoc.element.deployd.internal_resources.internal_resources">
        function <span class="apidocSignatureSpan">deployd.</span>internal_resources
        <span class="apidocSignatureSpan">(settings, server)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function InternalResources(settings, server) {
  settings.configPath = settings.configPath || './';
  Resource.apply(this, arguments);
  this.server = server;
  // internal resource
  this.internal = true;
  debug('constructed');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.internal_resources.super_" id="apidoc.element.deployd.internal_resources.super_">
        function <span class="apidocSignatureSpan">deployd.internal_resources.</span>super_
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Resource(name, options) {
  EventEmitter.call(this);
  this.name = name;
  this.path = '/' + name;
  options = this.options = options || {};
  this.config = options.config || {};
  this.events = {};
  var instance = this;
  if(this.constructor.external) {
    instance.external = {};
    Object.keys(this.constructor.external).forEach(function (key) {
      if(typeof instance.constructor.external[key] == 'function') {
        instance.external[key] = function () {
          instance.constructor.external[key].apply(instance, arguments);
        };
      }
    });
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.internal_resources.prototype" id="apidoc.module.deployd.internal_resources.prototype">module deployd.internal_resources.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.internal_resources.prototype.handle" id="apidoc.element.deployd.internal_resources.prototype.handle">
        function <span class="apidocSignatureSpan">deployd.internal_resources.prototype.</span>handle
        <span class="apidocSignatureSpan">(ctx, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">handle = function (ctx, next) {

  if (!ctx.req.isRoot) {
    ctx.done({statusCode: 401, message: "Not Allowed"});
    return;
  }

  var basepath = this.config.configPath;

  // TODO handle file system ENOENT, send all else to ctx.done
  // if(err) return ctx.done(err);

  var resource
    , id = ctx.url &amp;&amp; ctx.url.replace('/', '')
    , file;

  if(ctx.url === '/types') {
    loadTypes(function(defaults, types) {
      Object.keys(types).forEach(function(key) {
        defaults[key] = types[key];
      });
      Object.keys(defaults).forEach(function(key) {
        if(excludedTypes[key]) return;
        var c = defaults[key]
          , pages = c.dashboard &amp;&amp; c.dashboard.pages;

        if (!pages &amp;&amp; c.events) {
          pages = ['Config', 'Events'];
        }

        defaults[key] = {
          type: c.name,
          defaultPath: c.defaultPath,
          label: c.label,
          dashboardPages: pages
        };
      });
      ctx.done(null, defaults);
    });
    return;
  }

  if(ctx.req.method != 'GET' &amp;&amp; ctx.server) {
    // clear cache
    delete ctx.server.__resourceCache;
  }

  switch (ctx.req.method) {
    case 'POST':
    case 'PUT':
      var parts
        , fileName
        , isJson;

      resource = ctx.body;

      parts = (ctx.url || '').split('/').filter(function(p) { return p; });

      if (!parts || !parts.length) return ctx.done({statusCode: 400, message: "You must provide a resource"});

      id = parts[0];
      if (!parts[1] || parts[parts.length - 1].indexOf('.') === -1) {
        parts.push('config.json');
      }
      file = path.join(basepath, 'resources', parts.join('/'));

      fileName = parts[parts.length - 1].toLowerCase();
      isJson = fileName.lastIndexOf('.json') === fileName.length - 5;

      fs.stat(path.join(basepath, 'resources', id), function(err, stat) {
        if (!stat || !stat.isDirectory()) {
          fs.mkdir(path.join(basepath, 'resources', id), function(err) {
            if (err) return ctx.done(err);
            save();
          });
        } else {
          save();
        }
      });

      function save() {
        if (isJson &amp;&amp; !resource.$setAll) {
          fs.readFile(file, 'utf-8', function(err, currentValue) {
            if (!currentValue) {
              writeFile(resource);
            } else {
              try {
                var currentJson = JSON.parse(currentValue);
                Object.keys(resource).forEach(function(k) {
                  currentJson[k] = resource[k];
                });
                writeFile(currentJson);
              } catch (ex) {
                writeFile(resource);
              }
            }
          });
        } else if (isJson) {
          delete resource.$setAll;
          writeFile(resource);
        } else {
          writeFile(resource.value);
        }
      }

      function writeFile(value) {
        var newId = value.id;
        delete value.id;
        if (typeof value === 'object') value = JSON.stringify(value, null, '\t');
        notifyType(id, 'Changed', resource, ctx.server, function(eventError) {
          if(eventError) return ctx.done(eventError);

          fs.writeFile(file, value, function(err) {
            if (err) return ctx.done(err);

            if (fileName.lastIndexOf('config.json') === fileName.length - ('config.json').length &amp;&amp;
                newId &amp;&amp; newId !== id) {
              //rename
              if (newId.indexOf('/') === 0) newId = newId.substring(1);
              fs.rename(path.join(basepath, 'resources', id), path.join(basepath, 'resources', newId), function(err) {
                if (err) return ctx.done(err);
                resource.id = newId;
                ctx.done(null, resource);
              });
            } else {
              resource.id = id;
              ctx.done(null, resource);
            }
          });
        });
      }

      break;
    case 'GET':
      if(id) {
        isJson = undefined;
        file = id;
        if (id.lastIndexOf('.') &lt;= id.lastIndexOf('/')) {
          file += '/config.json';
        }
        isJson = file.lastIndex ...</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var doSettle = function (settledState, value) {
    state = settledState;
    // persist for handlers registered after settling
    outcome = value;

    thenHandlers.forEach(function (then) {
        then.<span class="apidocCodeKeywordSpan">handle</span>(state, outcome);
    });

    // Discard all references to handlers to be garbage collected
    thenHandlers = null;
};

var doFulfill = function (value) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.keys" id="apidoc.module.deployd.keys">module deployd.keys</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.keys.keys" id="apidoc.element.deployd.keys.keys">
        function <span class="apidocSignatureSpan">deployd.</span>keys
        <span class="apidocSignatureSpan">(path)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Keys(path) {
  this.path = path || '.dpd/keys.json';
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
*
* @param {Object} obj
* @return {Number}
* @api public
*/

exports.length = function(obj){
 return exports.<span class="apidocCodeKeywordSpan">keys</span>(obj).length;
};

/**
* Check if `obj` is empty.
*
* @param {Object} obj
* @return {Boolean}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.keys.prototype" id="apidoc.module.deployd.keys.prototype">module deployd.keys.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.keys.prototype.create" id="apidoc.element.deployd.keys.prototype.create">
        function <span class="apidocSignatureSpan">deployd.keys.prototype.</span>create
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">create = function (fn) {
  var key = this.generate()
    , keys = this;

  this.readFile(function(err, data) {
    if(err) return fn(err);

    data[key] = true;
    keys.writeFile(data, function(err) {
      fn(err, key);
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
## 0.6.3

 - Removed dependency on jQuery for dpd.js
 - JSON-formatted "bad credentials" login error
 - Improved error reporting on CLI when port is in use
 - If in development mode, and no port has been specifically requested, CLI will retry with up to 5 different ports
 - Fixed "no open connections" bug on startup
 - Renamed `Db.connect()` to `Db.<span class="apidocCodeKeywordSpan">create</span>()`
 - Db connections are now lazy and only occur once a request is made
 - Added 500 and 404 error pages
 - Added module domain error handling for better module errors
 - Added automatic reloading on error
 - Dropped support for node 0.6

## 0.6.2
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.keys.prototype.generate" id="apidoc.element.deployd.keys.prototype.generate">
        function <span class="apidocSignatureSpan">deployd.keys.prototype.</span>generate
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">generate = function () {
  return crypto.randomBytes(256).toString('hex');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
};

/*!
 * Create a new key and save it in the keys file.
 */

Keys.prototype.create = function(fn) {
  var key = this.<span class="apidocCodeKeywordSpan">generate</span>()
, keys = this;

  this.readFile(function(err, data) {
if(err) return fn(err);

data[key] = true;
keys.writeFile(data, function(err) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.keys.prototype.get" id="apidoc.element.deployd.keys.prototype.get">
        function <span class="apidocSignatureSpan">deployd.keys.prototype.</span>get
        <span class="apidocSignatureSpan">(key, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (key, fn) {
  this.readFile(function(err, data) {
    fn(err, data[key]);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  window.dpd = function(resource) {

    var r = {
get: function(func, path, query, fn) {
  var settings = parseGetSignature(arguments);
  settings.path = joinPath(resource, settings.path);

  return baseMethods.<span class="apidocCodeKeywordSpan">get</span>(settings, settings.fn);
}
, post: function(path, query, body, fn) {
  var settings = parsePostSignature(arguments);
  settings.path = joinPath(resource, settings.path);

  return baseMethods.post(settings, settings.fn);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.keys.prototype.getLocal" id="apidoc.element.deployd.keys.prototype.getLocal">
        function <span class="apidocSignatureSpan">deployd.keys.prototype.</span>getLocal
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getLocal = function (fn) {
  this.readFile(function(err, data) {
    if(err) return fn(err);
    if(data &amp;&amp; typeof data == 'object') {
      fn(null, Object.keys(data)[0]);
    } else {
      fn();
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
program
  .command('showkey')
  .description('\tshows current key for connecting to remote dashboard (./.dpd/keys.json)')
  .action(function() {
var Keys = require('../lib/keys')
  , keys = new Keys();

keys.<span class="apidocCodeKeywordSpan">getLocal</span>(function(err, key) {
  if(err) return console.error(err);
  if(!key) {
    console.log('No key file found. Run the following to create one:');
    console.log();
    console.log('dpd keygen');
    console.log();
    return;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.keys.prototype.readFile" id="apidoc.element.deployd.keys.prototype.readFile">
        function <span class="apidocSignatureSpan">deployd.keys.prototype.</span>readFile
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">readFile = function (fn) {
  fs.readFile(this.path, 'utf-8', function(err, data) {
    var jsonData
      , error;

    try {
      jsonData = (data &amp;&amp; JSON.parse(data)) || {};
    } catch (ex) {
      error = ex;
    }

    fn(error, jsonData);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    async.auto({
types: function(fn) {
  getTypes(fn);
},

configJsonFile: function(fn) {
  debug("reading %s", configPath);
  fs.<span class="apidocCodeKeywordSpan">readFile</span>(configPath, 'utf-8', fn);
},

configJson: ['configJsonFile', function(results, fn) {
  try {
    var settings = JSON.parse(results.configJsonFile);
    fn(null, settings);
  } catch (ex) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.keys.prototype.writeFile" id="apidoc.element.deployd.keys.prototype.writeFile">
        function <span class="apidocSignatureSpan">deployd.keys.prototype.</span>writeFile
        <span class="apidocSignatureSpan">(data, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">writeFile = function (data, fn) {
  var str;

  try {
    str = JSON.stringify(data);
  } catch(e) {
    return fn(e);
  }

  fs.writeFile(this.path, str, fn);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      var json;
      try {
        json = JSON.parse(body);
      } catch (ex) {}

      if (json &amp;&amp; json['dist-tags'] &amp;&amp; json['dist-tags'].latest) {
        var latest = json['dist-tags'].latest;
        fs.<span class="apidocCodeKeywordSpan">writeFile</span>(latestversionFile, latest, function(err){
          // Need this callback function to prevent the process being killed, when latestversionFile is NOT writable
        });
      }
    }
  });
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.mongod" id="apidoc.module.deployd.mongod">module deployd.mongod</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.mongod.restart" id="apidoc.element.deployd.mongod.restart">
        function <span class="apidocSignatureSpan">deployd.mongod.</span>restart
        <span class="apidocSignatureSpan">(mongod, env, port, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">restart = function (mongod, env, port, fn) {
  var pid;

  debug('starting %s', mongod);

  try {
    fs.unlinkSync('./data/mongod.lock');
    pid = JSON.parse(fs.readFileSync('./.dpd/pids/mongod'));

    if(pid) {
      debug('pid %s', pid);
      process.kill(pid);
    } else {
      debug('no pid found');
    }
  } catch(e) {}

<span class="apidocCodeCommentSpan">  /*!
  * The mongodb config file is set to the platform-specific null device in order to override the default options of mongodb in
  * Homebrew and similar distributions.
  */
</span>  var options =  ['--dbpath', './data', '--pidfilepath', './.dpd/pids/mongod', '--port', port, '-f', fs.existsSync('/dev/null') ? '/
dev/null' : 'NUL' ];
  if(env === 'development') {
    options.push('--nojournal');
    options.push('--smallfiles');
    options.push('--nssize');
    options.push('4');
  }

  var proc = spawn(mongod, options, {title: 'FOOBAR', stdio: 'pipe'})
    , buf = '';
  proc.stdout.on('data', function(data) {
    buf += data;
    if(~buf.indexOf('waiting for connections on port')) {
      proc.emit('listening');
    }
    debug(data);
  });

  function kill(e) {
    console.log('bye');
    if(e) debug('error: %s', e);
    debug('killing mongod');
    fs.writeFileSync('./.dpd/pids/mongod', '');
    proc.kill();
    process.exit(0);
  }

  // callback
  proc.once('listening', fn);
  proc.on('error', function(err) {
    debug('proc error %s %s', mongod, err);
    // report error to startup function in bin/dpd
    fn(err);
  });
  proc.on('exit', function(code) {
    debug('exit code %s', code);
    if (code) fn(code);
  });

  process.stdin.on('end', kill);

  process.on('exit', kill);
  // on non win32 platforms SIGTERM is emitted instead of exit when
  // a process is killed by another process, so use it to end our mongo
  // process
  process.on('SIGTERM', kill);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
              },
              startup
          );
      } else {
          startup();
      }
  } else {
      mongod.<span class="apidocCodeKeywordSpan">restart</span>(program.mongod || 'mongod', env, mongoPort, startup);
  }

} else {
  console.log("This directory does not contain a Deployd app!");
  console.log("Use \"dpd create &lt;appname&gt;\" to create a new app");
  console.log("or use \"dpd path/to/app.dpd\" to start an app in another directory");
  stop(1);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.resource" id="apidoc.module.deployd.resource">module deployd.resource</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.resource.resource" id="apidoc.element.deployd.resource.resource">
        function <span class="apidocSignatureSpan">deployd.</span>resource
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Resource(name, options) {
  EventEmitter.call(this);
  this.name = name;
  this.path = '/' + name;
  options = this.options = options || {};
  this.config = options.config || {};
  this.events = {};
  var instance = this;
  if(this.constructor.external) {
    instance.external = {};
    Object.keys(this.constructor.external).forEach(function (key) {
      if(typeof instance.constructor.external[key] == 'function') {
        instance.external[key] = function () {
          instance.constructor.external[key].apply(instance, arguments);
        };
      }
    });
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.resource.super_" id="apidoc.element.deployd.resource.super_">
        function <span class="apidocSignatureSpan">deployd.resource.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.resource.toJSON" id="apidoc.element.deployd.resource.toJSON">
        function <span class="apidocSignatureSpan">deployd.resource.</span>toJSON
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toJSON = function () {
  return {
    type: this.name,
    defaultPath: '/my-resource'
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
for (var i = 0; i &lt; obj.length; i++) {
    if (_hasBinary(obj[i])) {
        return true;
    }
}
    } else if (obj &amp;&amp; 'object' == typeof obj) {
if (obj.toJSON) {
  obj = obj.<span class="apidocCodeKeywordSpan">toJSON</span>();
}

for (var key in obj) {
  if (obj.hasOwnProperty(key) &amp;&amp; _hasBinary(obj[key])) {
    return true;
  }
}
...</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.resource.prototype" id="apidoc.module.deployd.resource.prototype">module deployd.resource.prototype</a></h1>






    <h2>
        <a href="#apidoc.element.deployd.resource.prototype.handle" id="apidoc.element.deployd.resource.prototype.handle">
        function <span class="apidocSignatureSpan">deployd.resource.prototype.</span>handle
        <span class="apidocSignatureSpan">(ctx, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">handle = function (ctx, next) {
  ctx.end();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var doSettle = function (settledState, value) {
    state = settledState;
    // persist for handlers registered after settling
    outcome = value;

    thenHandlers.forEach(function (then) {
        then.<span class="apidocCodeKeywordSpan">handle</span>(state, outcome);
    });

    // Discard all references to handlers to be garbage collected
    thenHandlers = null;
};

var doFulfill = function (value) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.resource.prototype.load" id="apidoc.element.deployd.resource.prototype.load">
        function <span class="apidocSignatureSpan">deployd.resource.prototype.</span>load
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">load = function (fn) {
  var eventNames = this.constructor &amp;&amp; this.constructor.events
    , remaining = eventNames &amp;&amp; eventNames.length
    , configPath = this.options &amp;&amp; this.options.configPath
    , events = this.events = {};

  if(remaining) {
    eventNames.forEach(function(e) {
      var fileName = e.toLowerCase() + '.js'
        , filePath = path.join(configPath, fileName);

      Script.load(filePath, function (err, script) {
        if (script) {
          events[e] = script;
        }
        remaining--;
        if (remaining &lt;= 0) {
          fn();
        }
      });
    });
  } else {
    fn();
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}, fn);
}

function loadResourceExtras(resource, fn) {
async.series([
  function(fn) {
    if (resource.load) {
      resource.<span class="apidocCodeKeywordSpan">load</span>(fn);
    } else {
      fn();
    }
  }
], function(err) {
  fn(err, resource);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.resource.prototype.parse" id="apidoc.element.deployd.resource.prototype.parse">
        function <span class="apidocSignatureSpan">deployd.resource.prototype.</span>parse
        <span class="apidocSignatureSpan">(url)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">parse = function (url) {
  var parsed = parse(url, true)
    , pathname = parsed.pathname
    , parts = parsed.parts = pathname.split('/');

  // remove empty
  parts.shift();
  parsed.basepath = parts[0];

  // remove empty trailing slash part
  if(parts[parts.length - 1] === '') parts.pop();

  // the last part is always the identifier
  if(parts.length &gt; 1) parsed.id = parts[parts.length - 1];

  if(parsed.query.q &amp;&amp; parsed.query.q[0] === '{' &amp;&amp; parsed.query.q[parsed.query.q.length - 1] === '}') {
    parsed.query.q = JSON.parse(parsed.query.q);
  }

  return parsed;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 }
}

/**
* Parse the arguments
*/

program.<span class="apidocCodeKeywordSpan">parse</span>(process.argv);

if(program.args.length === 0) start();

/**
* Port generation
*/
...</pre></li>
    </ul>






</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.router" id="apidoc.module.deployd.router">module deployd.router</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.router.router" id="apidoc.element.deployd.router.router">
        function <span class="apidocSignatureSpan">deployd.</span>router
        <span class="apidocSignatureSpan">(resources, server)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Router(resources, server) {
  this.resources = resources || [];
  this.server = server;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.router.prototype" id="apidoc.module.deployd.router.prototype">module deployd.router.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.router.prototype.generateRegex" id="apidoc.element.deployd.router.prototype.generateRegex">
        function <span class="apidocSignatureSpan">deployd.router.prototype.</span>generateRegex
        <span class="apidocSignatureSpan">(path)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">generateRegex = function (path) {
  if (!path || path === '/') path = '';
  path = path.replace(escapeRegExp, '\\$&amp;');
  return new RegExp('^' + path + '(?:[/?].*)?$');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    , result;

  debug('resources %j', this.resources.map(function(r) { return r.path; }));

  if (!this.resources || !this.resources.length) return [];

  result = this.resources.filter(function(d) {
    return url.match(router.<span class="apidocCodeKeywordSpan">generateRegex</span>(d.path));
  }).sort(function(a, b) {
    return specificness(b) - specificness(a);
  });
  return result;
};

/**
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.router.prototype.matchResources" id="apidoc.element.deployd.router.prototype.matchResources">
        function <span class="apidocSignatureSpan">deployd.router.prototype.</span>matchResources
        <span class="apidocSignatureSpan">(url)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">matchResources = function (url) {
  var router = this
    , result;

  debug('resources %j', this.resources.map(function(r) { return r.path; }));

  if (!this.resources || !this.resources.length) return [];

  result = this.resources.filter(function(d) {
    return url.match(router.generateRegex(d.path));
  }).sort(function(a, b) {
    return specificness(b) - specificness(a);
  });
  return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * @api public
 */

Router.prototype.route = function (req, res) {
var router = this
  , server = this.server
  , url = req.url
  , resources = this.<span class="apidocCodeKeywordSpan">matchResources</span>(url)
  , i = 0;

if (req._routed) {
  return;
}

req._routed = true;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.router.prototype.route" id="apidoc.element.deployd.router.prototype.route">
        function <span class="apidocSignatureSpan">deployd.router.prototype.</span>route
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">route = function (req, res) {
  var router = this
    , server = this.server
    , url = req.url
    , resources = this.matchResources(url)
    , i = 0;

  if (req._routed) {
    return;
  }

  req._routed = true;

  async.series([function(fn) {
    async.forEach(router.resources, function(resource, fn) {
      if(resource.handleSession) {
        var ctx = new Context(resource, req, res, server);
        resource.handleSession(ctx, fn);
      } else {
        fn();
      }
    }, fn);
  }], function(err) {
    if (err) throw err;
    nextResource();
  });

  //TODO: Handle edge case where ctx.next() is called more than once
  function nextResource() {
    var resource = resources[i++]
      , ctx;

    var handler = doh.createHandler({req: req, res: res, server: server});
    handler.run(function () {
      process.nextTick(function () {
        if (resource) {
          debug('routing %s to %s', req.url, resource.path);
          ctx = new Context(resource, req, res, server);
          ctx.router = router;

          // default root to false
          if(ctx.session) ctx.session.isRoot = req.isRoot || false;

          // external functions
          var furl = ctx.url.replace('/', '');
          if(resource.external &amp;&amp; resource.external[furl]) {
            resource.external[furl](ctx.body, ctx, ctx.done);
          } else {
            resource.handle(ctx, nextResource);
          }
        } else {
          debug('404 %s', req.url);
          res.statusCode = 404;
          error404({message: 'resource not found'}, req, res);
        }
      });
    });
  }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var root = req.headers['dpd-ssh-key'] || req.cookies.get('DpdSshKey');

if (server.options.env === 'development') {
  if (root) {
    req.isRoot = true;
  }
  server.<span class="apidocCodeKeywordSpan">route</span>(req, res);
} else if (root) {
  // all root requests
  // must be authenticated
  debug('authenticating', root);
  server.keys.get(root, function(err, key) {
    if(err) throw err;
    if(key) req.isRoot = true;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.script" id="apidoc.module.deployd.script">module deployd.script</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.script.script" id="apidoc.element.deployd.script.script">
        function <span class="apidocSignatureSpan">deployd.</span>script
        <span class="apidocSignatureSpan">(src, path)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Script(src, path) {
  this.scriptSourceCode = src;
  this.path = path;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.script.load" id="apidoc.element.deployd.script.load">
        function <span class="apidocSignatureSpan">deployd.script.</span>load
        <span class="apidocSignatureSpan">(path, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">load = function (path, fn) {
  fs.readFile(path, 'utf-8', function(err, val) {
    if (val) {
      fn(err, new Script(val, path));
    } else {
      fn(err);
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}, fn);
}

function loadResourceExtras(resource, fn) {
async.series([
  function(fn) {
    if (resource.load) {
      resource.<span class="apidocCodeKeywordSpan">load</span>(fn);
    } else {
      fn();
    }
  }
], function(err) {
  fn(err, resource);
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.script.prototype" id="apidoc.module.deployd.script.prototype">module deployd.script.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.script.prototype.getFunction" id="apidoc.element.deployd.script.prototype.getFunction">
        function <span class="apidocSignatureSpan">deployd.script.prototype.</span>getFunction
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getFunction = function (key) {
  var cache = memoize.cache;
  var address = '' + (hasher ? hasher.apply(this, arguments) : key);
  if (!_.has(cache, address)) cache[address] = func.apply(this, arguments);
  return cache[address];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Script.prototype.runWithContext = function (context) {
var functionArgs = Object.keys(context);

// remove the argument 'this' from our list of passed arguments, because it is a reserved word
functionArgs.splice(functionArgs.indexOf('this'), 1);

functionArgs.push(this.scriptSourceCode);
var func = this.<span class="apidocCodeKeywordSpan">getFunction</span>(functionArgs);

// pass our arguments from the sandbox to the function
var args = [];
functionArgs.forEach(function (p) {
  args.push(context[p]);
});
return func.apply(context._this || {}, args);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.script.prototype.run" id="apidoc.element.deployd.script.prototype.run">
        function <span class="apidocSignatureSpan">deployd.script.prototype.</span>run
        <span class="apidocSignatureSpan">(ctx, domain, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">run = function (ctx, domain, fn) {

  if (this.error) { fn(this.error); }

  if(typeof domain === 'function') {
    fn = domain;
    domain = undefined;
  }

  var req = ctx.req
    , session = ctx.session
    , waitingForCallback = false
    , callbackCount = 0
    , isDone = false
    , events;

  var scriptContext = {
    'this': {},
    cancel: function(msg, status) {
      var err;
      if (util.isError(msg)) {
        err = msg;
      } else if (!status &amp;&amp; msg &amp;&amp; msg.message &amp;&amp; (msg.status || msg.statusCode)) {
        // allow chaining this from another response
        err = {message: msg.message, statusCode: msg.status || msg.statusCode};
      } else {
        err = {message: msg, statusCode: status};
      }
      done(err);
      throw err;
    },
    cancelIf: function(condition, msg, status) {
      if (condition) {
        scriptContext.cancel(msg, status);
      }
    },
    cancelUnless: function(condition, msg, status) {
      scriptContext.cancelIf(!condition, msg, status);
    },
    me: session &amp;&amp; session.user,
    isMe: function(id) {
      return (scriptContext.me &amp;&amp; scriptContext.me.id === id) || false;
    },
    console: console,
    query: ctx.query,
    internal: req &amp;&amp; req.internal,
    isRoot: req &amp;&amp; req.session &amp;&amp; req.session.isRoot,
    emit: function(collection, query, event, data) {
      if(arguments.length === 4) {
        session.emitToUsers(collection, query, event, data);
      } else if(arguments.length === 3) {
        // collection is room name
        if(session.emitToRoom) session.emitToRoom(collection, query, event);
      } else if(arguments.length &lt;= 2) {
        event = collection;
        data = query;
        if(session.emitToAll) session.emitToAll(event, data);
      }
    },
    session: session,
    ctx: ctx
  };

  scriptContext._this = scriptContext['this'];
  scriptContext._error = undefined;

  events = new EventEmitter();

  function done(err) {
    if (isDone) return;
    isDone = true;
    events.removeAllListeners('finishCallback');
    if (fn) fn(err);
  }

  if(domain) {

    events.on('addCallback', function() {
      waitingForCallback = true;
      callbackCount++;
    });

    events.on('finishCallback', function() {
      callbackCount--;
      if (callbackCount &lt;= 0) {
        done(scriptContext._error);
      }
    });

    events.on('error', function (err) {
      done(err);
    });

    domain.$addCallback = function() {
      events.emit('addCallback');
    };

    domain.$finishCallback = function() {
      events.emit('finishCallback');
    };
    domain.dpd = ctx.dpd;

    if(fn) {
      // if a callback is expected, count callbacks
      // and manually merge the domain
      wrapAsyncFunctions(domain, scriptContext, events, done);
    } else {
      // otherwise just merge the domain
      Object.keys(domain).forEach(function (key) {
        scriptContext[key] = domain[key];
      });
    }
    scriptContext['this'] = scriptContext._this = domain.data;
  }

  var err;

  try {
    this.runWithContext(scriptContext);
  } catch(e) {
    err = wrapError(e);
    scriptContext._error = err;
  }
  err = err || scriptContext._error;
  process.nextTick(function () {
    if (!waitingForCallback &amp;&amp; callbackCount &lt;= 0) {
      done(err);
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  //TODO: Handle edge case where ctx.next() is called more than once
  function nextResource() {
    var resource = resources[i++]
      , ctx;

    var handler = doh.createHandler({req: req, res: res, server: server});
    handler.<span class="apidocCodeKeywordSpan">run</span>(function () {
      process.nextTick(function () {
        if (resource) {
debug('routing %s to %s', req.url, resource.path);
ctx = new Context(resource, req, res, server);
ctx.router = router;

// default root to false
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.script.prototype.runWithContext" id="apidoc.element.deployd.script.prototype.runWithContext">
        function <span class="apidocSignatureSpan">deployd.script.prototype.</span>runWithContext
        <span class="apidocSignatureSpan">(context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">runWithContext = function (context) {
  var functionArgs = Object.keys(context);

  // remove the argument 'this' from our list of passed arguments, because it is a reserved word
  functionArgs.splice(functionArgs.indexOf('this'), 1);

  functionArgs.push(this.scriptSourceCode);
  var func = this.getFunction(functionArgs);

  // pass our arguments from the sandbox to the function
  var args = [];
  functionArgs.forEach(function (p) {
    args.push(context[p]);
  });
  return func.apply(context._this || {}, args);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  }
  scriptContext['this'] = scriptContext._this = domain.data;
}

var err;

try {
  this.<span class="apidocCodeKeywordSpan">runWithContext</span>(scriptContext);
} catch(e) {
  err = wrapError(e);
  scriptContext._error = err;
}
err = err || scriptContext._error;
process.nextTick(function () {
  if (!waitingForCallback &amp;&amp; callbackCount &lt;= 0) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.server" id="apidoc.module.deployd.server">module deployd.server</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.server.server" id="apidoc.element.deployd.server.server">
        function <span class="apidocSignatureSpan">deployd.</span>server
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Server(options) {
  var server = process.server = this;
  http.Server.call(this);

  // defaults
  this.options = options = extend({
    port: 2403,
    db: {port: 27017, host: '127.0.0.1', name: 'deployd'}
  }, options);

  debug('started with options %j', options);

  // an object to map a server to its stores
  this.stores = {};

  // back all memory stores with a db
  this.db = db.create(options.db);

  var socketServer = io.listen(this, _.extend({
    'log level': 0
  }, (this.options.socketIo &amp;&amp; this.options.socketIo.options) || {}));

  // use socket io for a session based realtime channel
  this.sockets = socketServer.sockets;

  if (this.options.socketIo &amp;&amp; this.options.socketIo.adapter) {
    socketServer.adapter(this.options.socketIo.adapter);
  }

  // persist sessions in a store
  this.sessions = new SessionStore('sessions', this.db, this.sockets, options.sessions);

  // persist keys in a store
  this.keys = new Keys();

  this.on('request', server.handleRequest);

  server.on('request:error', function (err, req, res) {
    console.error();
    console.error(req.method, req.url, err.stack || err);
    process.exit(1);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.server.super_" id="apidoc.element.deployd.server.super_">
        function <span class="apidocSignatureSpan">deployd.server.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">super_ = function () {
    return;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.server.prototype" id="apidoc.module.deployd.server.prototype">module deployd.server.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.server.prototype.createStore" id="apidoc.element.deployd.server.prototype.createStore">
        function <span class="apidocSignatureSpan">deployd.server.prototype.</span>createStore
        <span class="apidocSignatureSpan">(namespace)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createStore = function (namespace) {
	return (this.stores[namespace] = this.db.createStore(namespace));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

/**
* Create a new `Store` for persisting data using the database info that was passed to the server when it was created.
*
* Example:
*
*     // Attach a store to the server
*     var todos = server.<span class="apidocCodeKeywordSpan">createStore</span>('todos');
*
*     // Use the store to CRUD data
*     todos.insert({name: 'go to the store', done: true}, ...); // see `Store` for more info
*
* @param {String} namespace
* @return {Store}
*/
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.server.prototype.handleRequest" id="apidoc.element.deployd.server.prototype.handleRequest">
        function <span class="apidocSignatureSpan">deployd.server.prototype.</span>handleRequest
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function handleRequest(req, res) {
  var server = this;
  // dont handle socket.io requests
  if(req.url.indexOf('/socket.io/') === 0) return;

  debug('%s %s', req.method, req.url);

  // add utilites to req and res
  setupReqRes(server.options, req, res, function(err, next) {
    if(err) return res.end(err.message);

    var authToken, usesBearerAuth = false;
    if (req.headers &amp;&amp; req.headers.authorization) {
      var parts = req.headers.authorization.split(' ');
      var scheme = parts[0]
      , credentials = parts[1];

      if (/^Bearer$/i.test(scheme)) {
        authToken = credentials;
        usesBearerAuth = true;
      }
    }

    server.sessions.createSession(authToken || req.cookies.get('sid'), function(err, session) {
      if(err) {
        debug('session error', err, session);
        throw err;
      } else {
        if (!usesBearerAuth) {
          // (re)set the session id cookie if we're not using Authorization Bearer
          if (session.sid) req.cookies.set('sid', session.sid);
        }
        req.session = session;

        var root = req.headers['dpd-ssh-key'] || req.cookies.get('DpdSshKey');

        if (server.options.env === 'development') {
          if (root) { req.isRoot = true; }
          server.route(req, res);
        } else if (root) {
          // all root requests
          // must be authenticated
          debug('authenticating', root);
          server.keys.get(root, function(err, key) {
            if(err) throw err;
            if(key) req.isRoot = true;
            debug('is root?', session.isRoot);
            server.route(req, res);
          });
        } else {
          // normal route
          server.route(req, res);
        }
      }
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
configLoader.loadConfig = sinon.spy();
server.route(req, res);

expect(configLoader.loadConfig.callCount).to.equal(1);
        });


        it('.<span class="apidocCodeKeywordSpan">handleRequest</span>(): should set a resources array on the server',
function () {
var server = attach(fakeHttpServer, opts);
var req = {url: 'foo', headers: {accept: '*'}};
var res = {body: 'bar', on: function () {}};

configLoader.loadConfig = function (path, server, callback) {
    callback.call(server, null, ['foo']);
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.server.prototype.listen" id="apidoc.element.deployd.server.prototype.listen">
        function <span class="apidocSignatureSpan">deployd.server.prototype.</span>listen
        <span class="apidocSignatureSpan">(port, host)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">listen = function (port, host) {
  var server = this;
  var serverpath = server.options.server_dir || fs.realpathSync('./');

  config.loadConfig(serverpath, server, function(err, resourcesInstances) {
    if (err) {
      console.error();
      console.error("Error loading resources: ");
      console.error(err.stack || err);
      process.exit(1);
    } else {
      server.resources = resourcesInstances;
      var router = new Router(resourcesInstances, server);
      server.router = router;
      http.Server.prototype.listen.call(server, port || server.options.port, host || server.options.host);
    }
  });
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
options.env = program.environment || process.env.DPD_ENV || options.env;
if(options.env !== 'development') console.log('starting in %s mode', options.env);

if(credentials !== undefined) options.db.credentials = credentials;
var dpd = createServer(options);
dpd.on('listening', onListening);
dpd.on('error', onError);
dpd.<span class="apidocCodeKeywordSpan">listen</span>();

function onListening () {
  console.info('listening on port', options.port);
  var commands = repl(dpd);
  if (program.dashboard) {
    commands.dashboard();
  } else if (program.open) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.server.prototype.route" id="apidoc.element.deployd.server.prototype.route">
        function <span class="apidocSignatureSpan">deployd.server.prototype.</span>route
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function route(req, res) {
  var server = this;
  var serverpath = server.options.server_dir || './';

  config.loadConfig(serverpath, server, function(err, resourcesInstances) {
    if (err) throw err;
    var router = new Router(resourcesInstances, server);
    server.router = router;

    server.resources = resourcesInstances;
    router.route(req, res);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var root = req.headers['dpd-ssh-key'] || req.cookies.get('DpdSshKey');

if (server.options.env === 'development') {
  if (root) {
    req.isRoot = true;
  }
  server.<span class="apidocCodeKeywordSpan">route</span>(req, res);
} else if (root) {
  // all root requests
  // must be authenticated
  debug('authenticating', root);
  server.keys.get(root, function(err, key) {
    if(err) throw err;
    if(key) req.isRoot = true;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.session" id="apidoc.module.deployd.session">module deployd.session</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.session.SessionStore" id="apidoc.element.deployd.session.SessionStore">
        function <span class="apidocSignatureSpan">deployd.session.</span>SessionStore
        <span class="apidocSignatureSpan">(namespace, db, sockets, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SessionStore(namespace, db, sockets, options) {
  var self = this;

  // unique id for this store in order to identify in a cluster
  this.id = this.createUniqueIdentifier();

  this.sockets = sockets;
  this.options = options || {};
  // sessions inactive for longer than this will be cleaned up:
  this.options.maxAge = this.options.maxAge || 30 * 24 * 60 * 60 * 1000;

  if (this.options.pubClient &amp;&amp; this.options.subClient) {
    debug('using pub/sub mode');
    this.pubClient = this.options.pubClient;
    this.subClient = this.options.subClient;
  }

  // socket queue
  var socketQueue = this.socketQueue = new EventEmitter()
    , socketIndex = this.socketIndex = {};

  if (sockets) {
    if (this.subClient) {
      // subscribe to messages regarding sessions joining/leaving rooms
      // need to resync
      this.subClient.subscribe('dpd#session#refreshrooms');
      this.subClient.subscribe('dpd#session#remove');
      this.subClient.on('message', function(channel, message) {
        var data;
        switch (channel) {
          case 'dpd#session#refreshrooms': // another node changed rooms for a session
            data = JSON.parse(message);
            if (data.id !== self.id &amp;&amp; data.sid &amp;&amp; socketIndex[data.sid]) {
              // if we know about this session, refresh the rooms
              self.refreshSessionRooms(data.sid);
            }

            break;
          case 'dpd#session#remove': // another node removed a session
            data = JSON.parse(message);
            if (data.id !== self.id &amp;&amp; data.sid &amp;&amp; sessionIndex[data.sid]) {
              // if we know about this session, remove it from memory
              sessionIndex[data.sid]._leaveAllRooms();
              self.removeSessionFromMemory(data.sid);
            }

            break;
        }
      });
    }

    sockets.on('connection', function(client) {
      // NOTE: do not use set here ever, the `Cookies` api is meant to get a req, res
      // but we are just using it for a cookie parser
      var cookies = new Cookies(client.handshake)
        , sid = cookies.get('sid');

      var getSession = function(sid, fn) {
        // check if we already know about the session
        var session = sessionIndex[sid];
        if (session) { return fn(null, session); }
        // get the session from the store otherwise
        self.createSession(sid, function(err, session) {
          if (session.data.id === sid) return fn(null, session);
          return fn();
        });
      };

      var indexSocket = function(sid, client, session) {
        // index sockets against their session id
        socketIndex[sid] = socketIndex[sid] || {};
        socketIndex[sid][client.id] = client;
        socketQueue.emit('socket', client, session);

        // make sure the list of rooms to join is fresh
        self.refreshSessionRooms(sid);
      };

      if (sid) {
        getSession(sid, function(err, session) {
          if (session) {
            indexSocket(sid, client, session);
          }
        });
      }

      // Alternative way of binding session to socket connection
      // for when the sid cookie is not yet available.
      // This expects that the client emits an event with the sid.
      function setSession(data) {
        if (!data || !data.sid || typeof data.sid !== 'string') { return; }
        var sid = data.sid;

        getSession(sid, function(err, session) {
          if (session) {
            // unassign socket from previous sessions
            _.each(socketIndex, function(val) {
              delete val[client.id];
            });

            indexSocket(sid, client, session);
          }
        });
      }

      client.on('server:setSession', setSession);
      client.on('server:setsession', setSession); // allow lowercase

      client.on('disconnect', function() {
        // unassign socket from previous sessions
        _.each(socketIndex, function(val, sid) {
          delete val[client.id];
        });
      });
    });

    var drainQueue = function drainQueue(method, rawSocket, session) {
      var key = ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.user_collection" id="apidoc.module.deployd.user_collection">module deployd.user_collection</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.user_collection.user_collection" id="apidoc.element.deployd.user_collection.user_collection">
        function <span class="apidocSignatureSpan">deployd.</span>user_collection
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function UserCollection(name, options) {
  Collection.apply(this, arguments);

  if(!this.properties) {
    this.properties = {};
  }

  // username and password are required
  this.properties.username = this.properties.username || {type: 'string'};
  this.properties.username.required = true;
  this.properties.password = this.properties.password || {type: 'string'};
  this.properties.password.required = true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.user_collection.super_" id="apidoc.element.deployd.user_collection.super_">
        function <span class="apidocSignatureSpan">deployd.user_collection.</span>super_
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Collection(name, options) {
  Resource.apply(this, arguments);
  var config = this.config;
  if(config) {
    this.properties = config.properties;
  }
  if (options) {
    this.store = options.db &amp;&amp; options.db.createStore(this.name);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>












</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.user_collection.prototype" id="apidoc.module.deployd.user_collection.prototype">module deployd.user_collection.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.user_collection.prototype.checkHash" id="apidoc.element.deployd.user_collection.prototype.checkHash">
        function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>checkHash
        <span class="apidocSignatureSpan">(uc, user, credentials)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">checkHash = function (uc, user, credentials) {
  // NOTE: there is no need for this to take uc as the first parameter
  var salt = user.password.substr(0, UserCollection.SALT_LEN)
    , hash = user.password.substr(UserCollection.SALT_LEN);

  return hash === uc.hash(credentials.password, salt);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
ctx.done('bad credentials');
      });
    }

    if (user) {
      // a user with this username exists
      delete userClone.password;
      if (uc.<span class="apidocCodeKeywordSpan">checkHash</span>(uc, user, credentials) === true) {
domain.success = true;
delete user.password; // make sure the password is not included in any sort of response

if (uc.events.Login) {
  uc.events.Login.run(ctx, domain, loginDone);
} else {
  loginDone();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.user_collection.prototype.getUserAndPasswordHash" id="apidoc.element.deployd.user_collection.prototype.getUserAndPasswordHash">
        function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>getUserAndPasswordHash
        <span class="apidocSignatureSpan">(user)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getUserAndPasswordHash = function (user) {
  return crypto.createHash('md5').update(user.username + user.password).digest('hex');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        // raw store query, need unmodified username and password
        return uc.store.find({id: ctx.session.data.uid, $fields: {username: 1, password: 1}}, function(err, user) {
if (err) {
  console.error("Internal Error: " + JSON.stringify(err));
  return ctx.done({statusCode: 500, message: "Error retrieving user for verification"});
}

var userHash = user ? uc.<span class="apidocCodeKeywordSpan">getUserAndPasswordHash</span>(user) : null;

// verify that the username and password haven't changed since this session was created
if (ctx.session.data.userhash === userHash) {
  // hash verified, call find() now to ensure all event scripts are executed
  return uc.find(ctx, function(err, user){
    if (!user) return noSuchUser(); // if the request was cancelled by the event script
    delete user.password;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.user_collection.prototype.handle" id="apidoc.element.deployd.user_collection.prototype.handle">
        function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>handle
        <span class="apidocSignatureSpan">(ctx)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">handle = function (ctx) {
  var uc = this;

  if (ctx.req.method == "GET" &amp;&amp; (ctx.url === '/count' || ctx.url.indexOf('/index-of') === 0)) {
    return Collection.prototype.handle.apply(uc, arguments);
  }

  if(ctx.url === '/logout') {
    var logoutDomain = { event: "LOGOUT" };
    uc.addDomainAdditions(logoutDomain);
    uc.doBeforeRequestEvent(ctx, logoutDomain, function(err) {
      if (err) return ctx.done(err);
      if (ctx.res.cookies) ctx.res.cookies.set('sid', null, {overwrite: true});
      ctx.session.remove(ctx.done);
    });
    return;
  }

  // set id if one wasnt provided in the query
  ctx.query.id = ctx.query.id || this.parseId(ctx) || (ctx.body &amp;&amp; ctx.body.id);

  // make sure password will never be included
  if(ctx.query.$fields) {
    var omit = true;
    for (var field in ctx.query.$fields) {
      if (ctx.query.$fields.hasOwnProperty(field) &amp;&amp; ctx.query.$fields[field] &gt; 0) {
        omit = false;
        if ('password' in ctx.query.$fields) delete ctx.query.$fields.password;
      }
      break;
    }
    if (omit || Object.keys(ctx.query.$fields).length === 0) ctx.query.$fields.password = 0;
  } else ctx.query.$fields = {password: 0};

  switch(ctx.req.method) {
    case 'GET':
      if(ctx.url === '/me') {
        debug('session %j', ctx.session.data);
        var noSuchUser = function () {
          // set no-cache headers
          ctx.res.setHeader("Cache-Control", "no-cache, no-store, must-revalidate");
          ctx.res.setHeader("Pragma", "no-cache");
          ctx.res.setHeader("Expires", "0");
          ctx.res.statusCode = 204;
          return ctx.done();
        };

        if(!(ctx.session &amp;&amp; ctx.session.data &amp;&amp; ctx.session.data.uid)) {
          return noSuchUser();
        }

        ctx.query = ctx.query || {};
        ctx.query.id = ctx.session.data.uid;

        // raw store query, need unmodified username and password
        return uc.store.find({id: ctx.session.data.uid, $fields: {username: 1, password: 1}}, function(err, user) {
          if (err) {
            console.error("Internal Error: " + JSON.stringify(err));
            return ctx.done({statusCode: 500, message: "Error retrieving user for verification"});
          }

          var userHash = user ? uc.getUserAndPasswordHash(user) : null;

          // verify that the username and password haven't changed since this session was created
          if (ctx.session.data.userhash === userHash) {
            // hash verified, call find() now to ensure all event scripts are executed
            return uc.find(ctx, function(err, user){
              if (!user) return noSuchUser(); // if the request was cancelled by the event script
              delete user.password;
              ctx.done.apply(null, arguments);
            });
          } else {
            noSuchUser();
          }
        });
      }

      this.find(ctx, ctx.done);
    break;
    case 'POST':
      if(ctx.url === '/login') {
        var loginDomain = { event: "LOGIN" };
        uc.addDomainAdditions(loginDomain);
        uc.doBeforeRequestEvent(ctx, loginDomain, function(err) {
          if (err) return ctx.done(err);
          uc.handleLogin(ctx);
        });
        break;
      }
<span class="apidocCodeCommentSpan">      /* falls through */
</span>    case 'PUT':
      if (!ctx.body &amp;&amp; typeof ctx.body !== "object") {
        return ctx.done("Missing request body");
      }
      this.setPassword(ctx.body);
      var isSelf = ctx.session.user &amp;&amp; ctx.session.user.id === ctx.query.id || (ctx.body &amp;&amp; ctx.body.id);
      if ((ctx.query.id || ctx.body.id) &amp;&amp; ctx.body &amp;&amp; !isSelf &amp;&amp; !ctx.session.isRoot &amp;&amp; !ctx.req.internal) {
        delete ctx.body.username;
        delete ctx.body.password;
      }

      function done(err, res) {
        if (res) delete res.password;
        ctx.done(err, res);
      }

      if(ctx.query.id || ctx.body.id) {
        this.save(ctx, done);
      } else {
        this.store.first({username: ctx.body.username}, function (err, u) {
          if(u) return ctx.done({errors: {username: 'is already in use'}});
          uc.save(ctx, done);
        });
      }
    break;
    cas ...</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var doSettle = function (settledState, value) {
    state = settledState;
    // persist for handlers registered after settling
    outcome = value;

    thenHandlers.forEach(function (then) {
        then.<span class="apidocCodeKeywordSpan">handle</span>(state, outcome);
    });

    // Discard all references to handlers to be garbage collected
    thenHandlers = null;
};

var doFulfill = function (value) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.user_collection.prototype.handleLogin" id="apidoc.element.deployd.user_collection.prototype.handleLogin">
        function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>handleLogin
        <span class="apidocSignatureSpan">(ctx)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">handleLogin = function (ctx) {
  var uc = this
    , path = uc.path
    , credentials = ctx.req.body || {};

  debug('trying to login as %s', credentials.username);
<span class="apidocCodeCommentSpan">  /* jshint eqnull:true */
</span>  // disable the jshint warning about needing === below
  // this checks whether the values are either null or undefined
  if (credentials.username == null || typeof credentials.username !== 'string' || credentials.password == null || typeof credentials
.password !== 'string') {
    ctx.res.statusCode = 400;
    ctx.done('username or password not specified');
    return;
  }

  this.loginFindUser(ctx, function (err, user) {
    if (err) return ctx.done(err);
    // keep a clone of the user so we can compare it later to see if any changes were made in the login event
    var userClone = user ? _.clone(user) : null
      , domain = { 'me': userClone, 'data': userClone, 'success': false };
    var usernameAndPasswordHash = user ? uc.getUserAndPasswordHash(user) : null;

    // checks if the user was changed in the login event and saves it if it was
    function checkAndSaveUser(fn) {
      if (user &amp;&amp; !_.isEqual(userClone, user)) {
        // something was changed, need to update the user
        debug('detected that user %s was updated from login event, saving...', credentials.username);
        // create a new context and set the body to our user so that we can call save on the collection
        var newCtx = _.clone(ctx);
        newCtx.body = userClone;
        // skip events when calling uc.save, so that validate and put is not called from this
        // internal call
        newCtx._internalSkipEvents = true;
        newCtx.query = { id: user.id };
        // disable changing the username from this event
        if (newCtx.body.username) delete newCtx.body.username;
        if (newCtx.body.id) delete newCtx.body.id; // remove id from body

        uc.save(newCtx, fn);
      } else {
        fn();
      }
    }

    function loginDone(err) {
      if (err) return ctx.done(err);
      checkAndSaveUser(function (err) {
        if (err) return ctx.done(err);
        debug('logged in as %s', credentials.username);
        ctx.session.set({ path: path, uid: user.id, userhash: usernameAndPasswordHash }).save(function (err, session) {
          if (err) return ctx.done("Internal error");
          uc.setSessionId(ctx, session.id);
          ctx.done(err, { path: session.path, id: session.id, uid: session.uid });
        });
      });
    }

    function loginFail(err) {
      checkAndSaveUser(function () {
        if (err) return ctx.done(err); // allow overriding of error message from event
        ctx.res.statusCode = 401;
        ctx.done('bad credentials');
      });
    }

    if (user) {
      // a user with this username exists
      delete userClone.password;
      if (uc.checkHash(uc, user, credentials) === true) {
        domain.success = true;
        delete user.password; // make sure the password is not included in any sort of response

        if (uc.events.Login) {
          uc.events.Login.run(ctx, domain, loginDone);
        } else {
          loginDone();
        }
        return;
      }
    }

    if (uc.events.Login) {
      uc.events.Login.run(ctx, domain, loginFail);
    } else {
      loginFail();
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
break;
case 'POST':
  if(ctx.url === '/login') {
    var loginDomain = { event: "LOGIN" };
    uc.addDomainAdditions(loginDomain);
    uc.doBeforeRequestEvent(ctx, loginDomain, function(err) {
      if (err) return ctx.done(err);
      uc.<span class="apidocCodeKeywordSpan">handleLogin</span>(ctx);
    });
    break;
  }
  /* falls through */
case 'PUT':
  if (!ctx.body &amp;&amp; typeof ctx.body !== "object") {
    return ctx.done("Missing request body");
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.user_collection.prototype.handleSession" id="apidoc.element.deployd.user_collection.prototype.handleSession">
        function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>handleSession
        <span class="apidocSignatureSpan">(ctx, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">handleSession = function (ctx, fn) {
  // called when any session has been created
  var session = ctx.session
    , path = this.path
    , uc = this;

  if(session &amp;&amp; session.data &amp;&amp; session.data.path == path &amp;&amp; session.data.uid) {
    this.store.find({ id: session.data.uid }, function (err, user) {
      if (user) {
        var userHash = uc.getUserAndPasswordHash(user);
        delete user.password;
        // verify that the username and password haven't changed since this session was created
        if (session.data.userhash === userHash) {
          session.user = user;
        } else {
          ctx.res.setHeader('X-Session-Invalidated', 'true');
        }
      }
      fn(err);
    });
  } else {
    fn();
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

req._routed = true;

async.series([function(fn) {
  async.forEach(router.resources, function(resource, fn) {
    if(resource.handleSession) {
      var ctx = new Context(resource, req, res, server);
      resource.<span class="apidocCodeKeywordSpan">handleSession</span>(ctx, fn);
    } else {
      fn();
    }
  }, fn);
}], function(err) {
  if (err) throw err;
  nextResource();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.user_collection.prototype.hash" id="apidoc.element.deployd.user_collection.prototype.hash">
        function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>hash
        <span class="apidocSignatureSpan">(password, salt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">hash = function (password, salt) {
  if (password &amp;&amp; !isNaN(password)){
    password = password.toString();
  }
  return crypto.createHmac('sha256', salt).update(password).digest('hex');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
*/
UserCollection.prototype.setPassword = function (body) {
 // do not add salt to empty string
 if(!body || !body.password || typeof body.password !== 'string' || body.password.length &lt; 1) {
     return;
 }
 var salt = uuid.create(UserCollection.SALT_LEN);
 body.password = salt + this.<span class="apidocCodeKeywordSpan">hash</span>(body.password, salt);
};

/**
* Hashes a password with the specified salt.
* @param  {string} password The password.
* @param  {string} salt     The salt.
* @return {string}          The hash, as a hex digest.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.user_collection.prototype.loginFindUser" id="apidoc.element.deployd.user_collection.prototype.loginFindUser">
        function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>loginFindUser
        <span class="apidocSignatureSpan">(ctx, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">loginFindUser = function (ctx, fn) {
  var credentials = ctx.req.body || { };
  return this.store.first({ username: credentials.username }, fn);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // this checks whether the values are either null or undefined
  if (credentials.username == null || typeof credentials.username !== 'string' || credentials.password == null || typeof
 credentials.password !== 'string') {
ctx.res.statusCode = 400;
ctx.done('username or password not specified');
return;
  }

  this.<span class="apidocCodeKeywordSpan">loginFindUser</span>(ctx, function (err, user) {
if (err) return ctx.done(err);
// keep a clone of the user so we can compare it later to see if any changes were made in the login event
var userClone = user ? _.clone(user) : null
  , domain = { 'me': userClone, 'data': userClone, 'success': false };
var usernameAndPasswordHash = user ? uc.getUserAndPasswordHash(user) : null;

// checks if the user was changed in the login event and saves it if it was
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.user_collection.prototype.setPassword" id="apidoc.element.deployd.user_collection.prototype.setPassword">
        function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>setPassword
        <span class="apidocSignatureSpan">(body)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setPassword = function (body) {
  // do not add salt to empty string
  if(!body || !body.password || typeof body.password !== 'string' || body.password.length &lt; 1) {
      return;
  }
  var salt = uuid.create(UserCollection.SALT_LEN);
  body.password = salt + this.hash(body.password, salt);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
			this.ctx.query = {username: "Foo", password: Math.random()};

			this.ctx.req.url = '/users';
			this.ctx.req.method = 'POST';
			this.ctx.req.body.username = 'foo@bar.com';
			this.ctx.req.body.password = Math.random();
			// hash the password so we can use it in our mocked loginFindUser function below
			this.uc.<span class="apidocCodeKeywordSpan">setPassword</span>(this.ctx.req.body);
			var hashedPassword = this.ctx.req.body.password;
			// reset it as plain test
			this.ctx.req.body.password = Math.random();

			this.uc.loginFindUser = function (ctx, fn) {
			  expect(ctx.req.body).to.eql({ username: 'foo@bar.com', password: 'abcd' });
			  fn(null, { id: '123', username: 'foo@bar.com', password: hashedPassword });
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.deployd.user_collection.prototype.setSessionId" id="apidoc.element.deployd.user_collection.prototype.setSessionId">
        function <span class="apidocSignatureSpan">deployd.user_collection.prototype.</span>setSessionId
        <span class="apidocSignatureSpan">(ctx, sessionId)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setSessionId = function (ctx, sessionId) {
  // dpd internal client does not have res.cookies
  if (ctx.res.cookies) ctx.res.cookies.set('sid', sessionId, { overwrite: true });
  if (ctx.res.setHeader) ctx.res.setHeader('X-Session-Token', sessionId);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}

function unwrapPromise(promise, fn) {
  return promise
  .then(function (res) {
    var sessionId = res.raw.getResponseHeader("X-Session-Token");
    if (sessionId) {
      window.dpd.<span class="apidocCodeKeywordSpan">setSessionId</span>(sessionId);
    }
    return res;
  })
  .then(function (res) {
    returnSuccess(fn)(res.data);
    return res.data;
  })
...</pre></li>
    </ul>






</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.deployd.uuid" id="apidoc.module.deployd.uuid">module deployd.uuid</a></h1>


    <h2>
        <a href="#apidoc.element.deployd.uuid.create" id="apidoc.element.deployd.uuid.create">
        function <span class="apidocSignatureSpan">deployd.uuid.</span>create
        <span class="apidocSignatureSpan">(length)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">create = function (length) {
  length = length || 16;
  var hexDigits = "0123456789abcdef";
  var s = crypto.randomBytes(length).toString('hex').split(''); // convert string to array
  s.length = length; // trim to length if bigger

  s[length - 3] = hexDigits.substr((s[length - 3] &amp; 0x3) | 0x8, 1);

  // return the uuid
  return s.join('');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
## 0.6.3

 - Removed dependency on jQuery for dpd.js
 - JSON-formatted "bad credentials" login error
 - Improved error reporting on CLI when port is in use
 - If in development mode, and no port has been specifically requested, CLI will retry with up to 5 different ports
 - Fixed "no open connections" bug on startup
 - Renamed `Db.connect()` to `Db.<span class="apidocCodeKeywordSpan">create</span>()`
 - Db connections are now lazy and only occur once a request is made
 - Added 500 and 404 error pages
 - Added module domain error handling for better module errors
 - Added automatic reloading on error
 - Dropped support for node 0.6

## 0.6.2
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>